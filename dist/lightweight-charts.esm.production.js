/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202307060029
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,s;function n(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function r(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function l(t){if(null===t)throw new Error("Value is null");return t}function a(t){return l(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(s||(s={}));const o={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function _(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,d=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,f=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,p=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function v(t){(t=t.toLowerCase())in o&&(t=o[t]);{const i=p.exec(t)||f.exec(t);if(i)return[_(parseInt(i[1],10)),_(parseInt(i[2],10)),_(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=d.exec(t);if(i)return[_(parseInt(i[1],16)),_(parseInt(i[2],16)),_(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[_(17*parseInt(i[1],16)),_(17*parseInt(i[2],16)),_(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function m(t){const i=v(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class b{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function w(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:w(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function M(t){return"number"==typeof t&&t%1==0}function S(t){return"string"==typeof t}function y(t){return"boolean"==typeof t}function k(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?k(e):e);return s}function C(t){return null!==t}function x(t){return null===t?void 0:t}const T="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function D(t,i,s){return void 0===i&&(i=T),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",A:"",O:0,L:0,I:0,B:0,V:0},this.N=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=D(i,s),t.B=2.5/12*i,t.O=t.B,t.L=i/12*t.C,t.I=i/12*t.C,t.V=0),t.R=this.$(),t.A=this.H(),this.S}$(){return this.N.F().layout.textColor}H(){return this.N.U()}W(){return this.N.F().layout.fontSize}j(){return this.N.F().layout.fontFamily}}class R{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,n){this.q.forEach((e=>{t.save(),e.X(t,i,s,n),t.restore()}))}}class A{X(t,i,s,n){t.save(),t.scale(i,i),this.Z(t,s,n),t.restore()}K(t,i,s,n){t.save(),t.scale(i,i),this.G(t,s,n),t.restore()}G(t,i,s){}}class O extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.rt,n(s.ht+2),t.fillStyle=s.lt,n(s.ht)}}function L(){return{st:[{nt:0,et:0,ot:0,_t:0}],lt:"",rt:"",ht:0,it:null}}const E={from:0,to:1};class I{constructor(t,i){this.ut=new R,this.ct=[],this.dt=[],this.ft=!0,this.N=t,this.vt=i,this.ut.Y(this.ct)}bt(t){const i=this.N.wt();i.length!==this.ct.length&&(this.dt=i.map(L),this.ct=this.dt.map((t=>{const i=new O;return i.tt(t),i})),this.ut.Y(this.ct)),this.ft=!0}gt(t,i,s){return this.ft&&(this.Mt(t),this.ft=!1),this.ut}Mt(t){const i=this.N.wt(),s=this.vt.St(),n=this.N.yt();i.forEach(((i,e)=>{var r;const h=this.dt[e],a=i.kt(s);if(null===a||!i.Ct())return void(h.it=null);const o=l(i.xt());h.lt=a.Tt,h.ht=a.ht,h.st[0]._t=a._t,h.st[0].et=i.Pt().Dt(a._t,o.Rt),h.rt=null!==(r=a.At)&&void 0!==r?r:this.N.Ot(h.st[0].et/t),h.st[0].ot=s,h.st[0].nt=n.Lt(s),h.it=E}))}}class B{constructor(t){this.Et=t}X(t,i,s,r){if(null===this.Et)return;const h=this.Et.It.Ct,l=this.Et.Bt.Ct;if(!h&&!l)return;t.save();const a=Math.round(this.Et.nt*i),o=Math.round(this.Et.et*i),_=Math.ceil(this.Et.Vt*i),u=Math.ceil(this.Et.Nt*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Et.It.Ft*i),t.strokeStyle=this.Et.It.R,t.fillStyle=this.Et.It.R,n(t,this.Et.It.Wt),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Et.Bt.Ft*i),t.strokeStyle=this.Et.Bt.R,t.fillStyle=this.Et.Bt.R,n(t,this.Et.Bt.Wt),e(t,o,0,_)),t.restore()}}class V{constructor(t){this.ft=!0,this.zt={It:{Ft:1,Wt:0,R:"",Ct:!1},Bt:{Ft:1,Wt:0,R:"",Ct:!1},Vt:0,Nt:0,nt:0,et:0},this.jt=new B(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(),this.ft=!1),this.jt}Mt(){const t=this.$t.Ct(),i=l(this.$t.Ht()),s=i.Ut().F().crosshair,n=this.zt;n.Bt.Ct=t&&this.$t.qt(i),n.It.Ct=t&&this.$t.Yt(),n.Bt.Ft=s.horzLine.width,n.Bt.Wt=s.horzLine.style,n.Bt.R=s.horzLine.color,n.It.Ft=s.vertLine.width,n.It.Wt=s.vertLine.style,n.It.R=s.vertLine.color,n.Vt=i.Xt(),n.Nt=i.Zt(),n.nt=this.$t.Kt(),n.et=this.$t.Gt()}}function N(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function F(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function W(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function z(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function j(t,i,s,n,e,r){let h,l,a,o;if(Array.isArray(r))if(2===r.length){const t=Math.max(0,r[0]),i=Math.max(0,r[1]);h=t,l=t,a=i,o=i}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");h=Math.max(0,r[0]),l=Math.max(0,r[1]),a=Math.max(0,r[2]),o=Math.max(0,r[3])}else{const t=Math.max(0,r);h=t,l=t,a=t,o=t}t.beginPath(),t.moveTo(i+h,s),t.lineTo(i+n-l,s),0!==l&&t.arcTo(i+n,s,i+n,s+l,l),t.lineTo(i+n,s+e-a),0!==a&&t.arcTo(i+n,s+e,i+n-a,s+e,a),t.lineTo(i+o,s+e),0!==o&&t.arcTo(i,s+e,i,s+e-o,o),t.lineTo(i,s+h),0!==h&&t.arcTo(i,s,i+h,s,h)}function $(t,i,s,n,e,r,h=0,l=0,a=""){if(t.save(),!h||!a||a===r)return j(t,i,s,n,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;if("transparent"!==r){j(t,i+h,s+h,n-2*h,e-2*h,z(l,-h)),t.fillStyle=r,t.fill()}if("transparent"!==a){j(t,i+o,s+o,n-h,e-h,z(l,-o)),t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()}}function H(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class U{constructor(t,i){this.tt(t,i)}tt(t,i){this.Et=t,this.Jt=i}X(t,i,s,n,e,r){if(!this.Et.Ct)return;t.font=i.D;const h=this.Qt(t,i,s,n,e,r),l=this.Et.R||this.Jt.R,a=this.Jt.t;if(t.fillStyle=this.Jt.t,this.Et.ti){const s=(i,s)=>{h.ii?$(t,h.si,h.ni,h.ei,h.ri,i,h.hi,[h.ht,0,0,h.ht],s):$(t,h.li,h.ni,h.ei,h.ri,i,h.hi,[0,h.ht,h.ht,0],s)};s(a,"transparent"),this.Et.ai&&(t.fillStyle=l,t.fillRect(h.li,h.oi,h._i-h.li,h.ui)),s("transparent",a),this.Et.ci&&(t.fillStyle=i.A,t.fillRect(h.ii?h.di-h.hi:0,h.ni,h.hi,h.fi-h.ni)),t.save(),t.translate(h.pi,(h.ni+h.fi)/2+h.vi),F(t,r,(()=>{t.fillStyle=l,t.fillText(this.Et.ti,0,0)})),t.restore()}}Zt(t,i){return this.Et.Ct?t.T+t.B+t.O:0}Qt(t,i,s,n,e,r){const h=this.Et.ai||!this.Et.mi?i.C:0,l=i.k,a=i.B+this.Jt.bi,o=i.O+this.Jt.wi,_=i.L,u=i.I,c=this.Et.ti,d=i.T,f=s.gi(t,c)*r,p=d+a+o,v=l+_+u+Math.ceil(s.Mi(t,c))+h,m=Math.max(1,Math.floor(r));let b=Math.round(p*r);b%2!=m%2&&(b+=1);const w=this.Et.Si?Math.max(1,Math.floor(l*r)):0,g=Math.round(v*r),M=Math.round(h*r),S=Math.ceil(n*r),y=Math.ceil(_*r);let k=this.Jt.yi;this.Jt.ki&&(k=this.Jt.ki),k=Math.round(k*r)-Math.floor(.5*r);const C=Math.floor(k+m/2-b/2),x=C+b,T="right"===e,D=T?S-w:w,P=S;let R,A,O=D;const L=2*r;return t.textAlign=T?"right":"left",t.textBaseline="middle",T?(O=D-g,R=D-M,A=D-M-y-1):(O=D+g,R=D+M,A=D+M+y),{ii:T,ni:C,oi:k,fi:x,ei:g,ri:b,ht:L,hi:w,si:O,li:D,_i:R,pi:A,ui:m,di:P,vi:f}}}class q{constructor(t){this.Ci={yi:0,R:"#FFF",t:"#000",wi:0,bi:0},this.xi={ti:"",Ct:!1,ai:!0,mi:!1,At:"",R:"#FFF",ci:!1,Si:!1},this.Ti={ti:"",Ct:!1,ai:!1,mi:!0,At:"",R:"#FFF",ci:!0,Si:!0},this.ft=!0,this.Di=new(t||U)(this.xi,this.Ci),this.Pi=new(t||U)(this.Ti,this.Ci)}ti(){return this.Ri(),this.xi.ti}yi(){return this.Ri(),this.Ci.yi}bt(){this.ft=!0}Zt(t,i=!1){return Math.max(this.Di.Zt(t,i),this.Pi.Zt(t,i))}Ai(){return this.Ci.ki||0}Oi(t){this.Ci.ki=t}Li(){return this.Ri(),this.xi.Ct||this.Ti.Ct}Ei(){return this.Ri(),this.xi.Ct}gt(t){return this.Ri(),this.xi.ai=this.xi.ai&&t.F().ticksVisible,this.Ti.ai=this.Ti.ai&&t.F().ticksVisible,this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Di}Ii(){return this.Ri(),this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Pi}Ri(){this.ft&&(this.xi.ai=!0,this.Ti.ai=!1,this.Bi(this.xi,this.Ti,this.Ci))}}class Y extends q{constructor(t,i,s){super(),this.$t=t,this.Vi=i,this.Ni=s}Bi(t,i,s){t.Ct=!1;const n=this.$t.F().horzLine;if(!n.labelVisible)return;const e=this.Vi.xt();if(!this.$t.Ct()||this.Vi.Fi()||null===e)return;const r=m(n.labelBackgroundColor);s.t=r.t,s.R=r.i;const h=2/12*this.Vi.T();s.bi=h,s.wi=h;const l=this.Ni(this.Vi);s.yi=l.yi,t.ti=this.Vi.Wi(l._t,e),t.Ct=!0}}const X=/[1-9]/g;class Z{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s){if(null===this.Et||!1===this.Et.Ct||0===this.Et.ti.length)return;t.font=i.D;const n=Math.round(i.zi.Mi(t,this.Et.ti,X));if(n<=0)return;t.save();const e=i.ji,r=n+2*e,h=r/2,a=this.Et.Xt;let o=this.Et.yi,_=Math.floor(o-h)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-h)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-h)+.5);const u=_+r,c=Math.ceil(0+i.k+i.C+i.B+i.T+i.O);t.fillStyle=this.Et.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s),m=Math.round(2*s);if(t.beginPath(),t.moveTo(d,f),t.lineTo(d,v-m),t.arcTo(d,v,d+m,v,m),t.lineTo(p-m,v),t.arcTo(p,v,p,v-m,m),t.lineTo(p,f),t.fill(),this.Et.ai){const n=Math.round(this.Et.yi*s),e=f,r=Math.round((e+i.C)*s);t.fillStyle=this.Et.R;const h=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(n-l,e,h,r-e)}const b=0+i.k+i.C+i.B+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Et.R;const w=i.zi.gi(t,"Apr0");t.translate((_+e)*s,(b+w)*s),F(t,s,(()=>t.fillText(l(this.Et).ti,0,0))),t.restore()}}class K{constructor(t,i,s){this.ft=!0,this.jt=new Z,this.zt={Ct:!1,t:"#4c525e",R:"white",ti:"",Xt:0,yi:NaN,ai:!0},this.vt=t,this.$i=i,this.Ni=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.jt.tt(this.zt),this.jt}Mt(){const t=this.zt;t.Ct=!1;const i=this.vt.F().vertLine;if(!i.labelVisible)return;const s=this.$i.yt();if(s.Fi())return;t.Xt=s.Xt();const n=this.Ni();if(!n.ot)return;t.yi=n.yi;const e=s.Hi(this.vt.St());t.ti=s.Ui(l(e)),t.Ct=!0;const r=m(i.labelBackgroundColor);t.t=r.t,t.R=r.i,t.ai=s.F().ticksVisible}}class G{constructor(){this.qi=null,this.Yi=0}Xi(){return this.Yi}Zi(t){this.Yi=t}Pt(){return this.qi}Ki(t){this.qi=t}Gi(t){return[]}Ji(){return[]}Ct(){return!0}}var J;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(J||(J={}));class Q extends G{constructor(t,i){super(),this.Qi=null,this.ts=NaN,this.ss=0,this.ns=!0,this.es=new Map,this.rs=!1,this.hs=NaN,this.ls=NaN,this.os=NaN,this._s=NaN,this.$i=t,this.us=i,this.cs=new I(t,this);this.ds=((t,i)=>s=>{const n=i(),e=t();if(s===l(this.Qi).fs())return{_t:e,yi:n};{const t=l(s.xt());return{_t:s.ps(n,t),yi:n}}})((()=>this.ts),(()=>this.ls));const s=((t,i)=>()=>({ot:this.$i.yt().vs(t()),yi:i()}))((()=>this.ss),(()=>this.Kt()));this.bs=new K(this,t,s),this.ws=new V(this)}F(){return this.us}gs(t,i){this.os=t,this._s=i}Ms(){this.os=NaN,this._s=NaN}Ss(){return this.os}ys(){return this._s}ks(t,i,s){this.rs||(this.rs=!0),this.ns=!0,this.Cs(t,i,s)}St(){return this.ss}Kt(){return this.hs}Gt(){return this.ls}Ct(){return this.ns}xs(){this.ns=!1,this.Ts(),this.ts=NaN,this.hs=NaN,this.ls=NaN,this.Qi=null,this.Ms()}Ds(t){return null!==this.Qi?[this.ws,this.cs]:[]}qt(t){return t===this.Qi&&this.us.horzLine.visible}Yt(){return this.us.vertLine.visible}Ps(t,i){this.ns&&this.Qi===t||this.es.clear();const s=[];return this.Qi===t&&s.push(this.Rs(this.es,i,this.ds)),s}Ji(){return this.ns?[this.bs]:[]}Ht(){return this.Qi}As(){this.ws.bt(),this.es.forEach((t=>t.bt())),this.bs.bt(),this.cs.bt()}Os(t){return t&&!t.fs().Fi()?t.fs():null}Cs(t,i,s){this.Ls(t,i,s)&&this.As()}Ls(t,i,s){const n=this.hs,e=this.ls,r=this.ts,h=this.ss,l=this.Qi,a=this.Os(s);this.ss=t,this.hs=isNaN(t)?NaN:this.$i.yt().Lt(t),this.Qi=s;const o=null!==a?a.xt():null;return null!==a&&null!==o?(this.ts=i,this.ls=a.Dt(i,o)):(this.ts=NaN,this.ls=NaN),n!==this.hs||e!==this.ls||h!==this.ss||r!==this.ts||l!==this.Qi}Ts(){const t=this.$i.wt().map((t=>t.Is().Es())).filter(C),i=0===t.length?null:Math.max(...t);this.ss=null!==i?i:NaN}Rs(t,i,s){let n=t.get(i);return void 0===n&&(n=new Y(this,i,s),t.set(i,n)),n}}function tt(t){return"left"===t||"right"===t}class it{constructor(t){this.Bs=new Map,this.Vs=[],this.Ns=t}Fs(t,i){const s=function(t,i){return void 0===t?i:{Ws:Math.max(t.Ws,i.Ws),zs:t.zs||i.zs}}(this.Bs.get(t),i);this.Bs.set(t,s)}js(){return this.Ns}$s(t){const i=this.Bs.get(t);return void 0===i?{Ws:this.Ns}:{Ws:Math.max(this.Ns,i.Ws),zs:i.zs}}Hs(){this.Us(),this.Vs=[{qs:0}]}Ys(t){this.Us(),this.Vs=[{qs:1,Rt:t}]}Xs(t){this.Zs(),this.Vs.push({qs:5,Rt:t})}Us(){this.Zs(),this.Vs.push({qs:6})}Ks(){this.Us(),this.Vs=[{qs:4}]}Gs(t){this.Us(),this.Vs.push({qs:2,Rt:t})}Js(t){this.Us(),this.Vs.push({qs:3,Rt:t})}Qs(){return this.Vs}tn(t){for(const i of t.Vs)this.sn(i);this.Ns=Math.max(this.Ns,t.Ns),t.Bs.forEach(((t,i)=>{this.Fs(i,t)}))}static nn(){return new it(2)}static en(){return new it(3)}sn(t){switch(t.qs){case 0:this.Hs();break;case 1:this.Ys(t.Rt);break;case 2:this.Gs(t.Rt);break;case 3:this.Js(t.Rt);break;case 4:this.Ks();break;case 5:this.Xs(t.Rt);break;case 6:this.Zs()}}Zs(){const t=this.Vs.findIndex((t=>5===t.qs));-1!==t&&this.Vs.splice(t,1)}}const st=".";function nt(t,i){if(!g(t))return"n/a";if(!M(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class et{constructor(t,i){if(i||(i=1),g(t)&&M(t)||(t=100),t<0)throw new TypeError("invalid base");this.Vi=t,this.rn=i,this.hn()}format(t){const i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.ln(t)}hn(){if(this.an=0,this.Vi>0&&this.rn>0){let t=this.Vi;for(;t>1;)t/=10,this.an++}}ln(t){const i=this.Vi/this.rn;let s=Math.floor(t),n="";const e=void 0!==this.an?this.an:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.an);r>=i&&(r-=i,s+=1),n=st+nt(+r.toFixed(this.an)*this.rn,e)}else s=Math.round(s*i)/i,e>0&&(n=st+nt(0,e));return s.toFixed(0)+n}}class rt extends et{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class ht{constructor(t){this.on=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this._n(t):t<999995?i+this._n(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this._n(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this._n(t/1e9)+"B")}_n(t){let i;const s=Math.pow(10,this.on);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.on).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function lt(t,i,s,n,e,r,h){if(0===i.length||n.from>=i.length)return;const l=i[n.from];let a=r(t,l),o=l;if(n.to-n.from<2){const i=e/2;t.beginPath();const s={nt:l.nt-i,et:l.et},n={nt:l.nt+i,et:l.et};return t.moveTo(s.nt,s.et),t.lineTo(n.nt,n.et),void h(t,a,s,n)}const _=(i,s)=>{h(t,a,o,s),t.beginPath(),a=i,o=s};let u=o;t.beginPath(),t.moveTo(l.nt,l.et);for(let e=n.from+1;e<n.to;++e){u=i[e];const n=r(t,u);switch(s){case 0:t.lineTo(u.nt,u.et);break;case 1:t.lineTo(u.nt,i[e-1].et),n!==a&&(_(n,u),t.lineTo(u.nt,i[e-1].et)),t.lineTo(u.nt,u.et);break;case 2:{const[s,n]=ut(i,e-1,e);t.bezierCurveTo(s.nt,s.et,n.nt,n.et,u.nt,u.et);break}}1!==s&&n!==a&&(_(n,u),t.moveTo(u.nt,u.et))}(o!==u||o===u&&1===s)&&h(t,a,o,u)}const at=6;function ot(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function _t(t,i){return{nt:t.nt/i,et:t.et/i}}function ut(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=_t(ot(t[s],t[n]),at),{nt:r.nt+h.nt,et:r.et+h.et}),ot(t[s],_t(ot(t[e],t[i]),at))]}function ct(t,i,s,n,e){i.lineTo(e.nt,t),i.lineTo(n.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class dt extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:e,Ft:r,Wt:h,cn:l,dn:a}=this.J;null!==s&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=r,n(t,h),t.lineWidth=1,lt(t,i,l,s,e,this.fn.bind(this),ct.bind(null,a)))}}class ft extends dt{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{vn:n,mn:e}=i,r=s.bn;if(null!==this.pn&&this.pn.topColor===n&&this.pn.bottomColor===e&&this.pn.bottom===r)return this.pn.fillStyle;const h=t.createLinearGradient(0,0,0,r);return h.addColorStop(0,n),h.addColorStop(1,e),this.pn={topColor:n,bottomColor:e,fillStyle:h,bottom:r},h}}function pt(t,i){t.strokeStyle=i,t.stroke()}class vt extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:e,cn:r,Ft:h,Wt:l}=this.J;null!==s&&(t.lineCap="butt",t.lineWidth=h,n(t,l),t.lineJoin="round",lt(t,i,r,s,e,this.wn.bind(this),pt))}}class mt extends vt{wn(t,i){return i.lt}}function bt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function wt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function gt(t,i){return t.ot<i}function Mt(t,i){return t<i.ot}function St(t,i,s){const n=i.gn(),e=i.Mn(),r=bt(t,n,gt),h=wt(t,e,Mt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ot>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ot<=e&&(a=h+1),{from:l,to:a}}class yt{constructor(t,i,s){this.Sn=!0,this.yn=!0,this.kn=!0,this.Cn=[],this.xn=null,this.Tn=t,this.Dn=i,this.Pn=s}bt(t){this.Sn=!0,"data"===t&&(this.yn=!0),"options"===t&&(this.kn=!0)}gt(t,i){return this.Tn.Ct()?(this.Rn(i,t),null===this.xn?null:this.An):null}On(){this.Cn=this.Cn.map((t=>Object.assign(Object.assign({},t),this.Tn.En().Ln(t.ot))))}In(){this.xn=null}Rn(t,i){this.yn&&(this.Bn(),this.yn=!1),this.kn&&(this.On(),this.kn=!1),this.Sn&&(this.Vn(t,i),this.Sn=!1)}Vn(t,i){const s=this.Tn.Pt(),n=this.Dn.yt();if(this.In(),n.Fi()||s.Fi())return;const e=n.Nn();if(null===e)return;if(0===this.Tn.Is().Fn())return;const r=this.Tn.xt();null!==r&&(this.xn=St(this.Cn,e,this.Pn),this.Wn(s,n,r.Rt),this.zn(t,i))}}class kt extends yt{constructor(t,i){super(t,i,!0)}Wn(t,i,s){i.jn(this.Cn,x(this.xn)),t.$n(this.Cn,s,x(this.xn))}Hn(t,i){return{ot:t,_t:i,nt:NaN,et:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Is().Un().map((i=>{const s=i.Rt[3];return this.qn(i.Yn,s,t)}))}}class Ct extends kt{constructor(t,i){super(t,i),this.An=new R,this.Xn=new ft,this.Zn=new mt,this.An.Y([this.Xn,this.Zn])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.F(),n=s.invertFilledArea?0:i;this.Xn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,dn:n,bn:i,it:this.xn,un:this.Dn.yt().Kn()}),this.Zn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,it:this.xn,un:this.Dn.yt().Kn()})}}class xt{constructor(){this.Et=null,this.Gn=0,this.Jn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;if(this.Gn=this.Qn(i),this.Gn>=2){Math.max(1,Math.floor(i))%2!=this.Gn%2&&this.Gn--}this.Jn=this.Et.te?Math.min(this.Gn,Math.floor(i)):this.Gn;let e=null;const r=this.Jn<=this.Gn&&this.Et.Kn>=Math.floor(1.5*i);for(let s=this.Et.it.from;s<this.Et.it.to;++s){const n=this.Et.Is[s];e!==n.ie&&(t.fillStyle=n.ie,e=n.ie);const h=Math.floor(.5*this.Jn),l=Math.round(n.nt*i),a=l-h,o=this.Jn,_=a+o-1,u=Math.min(n.se,n.ne),c=Math.max(n.se,n.ne),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.Jn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.Gn);if(r){if(this.Et.ee){const s=l-v;let e=Math.max(d,Math.round(n.re*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.he*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}Qn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(l(this.Et).Kn,t)))}}class Tt extends yt{constructor(t,i){super(t,i,!1)}Wn(t,i,s){i.jn(this.Cn,x(this.xn)),t.le(this.Cn,s,x(this.xn))}ae(t,i,s){return{ot:t,oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3],nt:NaN,re:NaN,se:NaN,ne:NaN,he:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Is().Un().map((i=>this.qn(i.Yn,i,t)))}}class Dt extends Tt{constructor(){super(...arguments),this.An=new xt}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Is:this.Cn,Kn:this.Dn.yt().Kn(),ee:t.openVisible,te:t.thinBars,it:this.xn})}}function Pt(t,i,s){return Math.min(Math.max(t,i),s)}function Rt(t,i,s){return i-t<=s}function At(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Ot(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Lt extends dt{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{de:n,fe:e,pe:r,ve:h}=i,{dn:l,bn:a}=s;if(null!==this.pn&&this.pn.topFillColor1===n&&this.pn.topFillColor2===e&&this.pn.bottomFillColor1===r&&this.pn.bottomFillColor2===h&&this.pn.baseLevelCoordinate===l&&this.pn.bottom===a)return this.pn.fillStyle;const o=t.createLinearGradient(0,0,0,a),_=Pt(l/a,0,1);return o.addColorStop(0,n),o.addColorStop(_,e),o.addColorStop(_,r),o.addColorStop(1,h),this.pn={topFillColor1:n,topFillColor2:e,bottomFillColor1:r,bottomFillColor2:h,fillStyle:o,baseLevelCoordinate:l,bottom:a},o}}class Et extends vt{constructor(){super(...arguments),this.me=null}wn(t,i){const s=this.J,{be:n,we:e}=i,{dn:r,bn:h}=s;if(null!==this.me&&this.me.topLineColor===n&&this.me.bottomLineColor===e&&this.me.baseLevelCoordinate===r&&this.me.bottom===h)return this.me.strokeStyle;const l=t.createLinearGradient(0,0,0,h),a=Pt(r/h,0,1);return l.addColorStop(0,n),l.addColorStop(a,n),l.addColorStop(a,e),l.addColorStop(1,e),this.me={topLineColor:n,bottomLineColor:e,strokeStyle:l,baseLevelCoordinate:r,bottom:h},l}}class It extends kt{constructor(t,i){super(t,i),this.An=new R,this.ge=new Lt,this.Me=new Et,this.An.Y([this.ge,this.Me])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.xt();if(null===s)return;const n=this.Tn.F(),e=this.Tn.Pt().Dt(n.baseValue.price,s.Rt),r=this.Dn.yt().Kn();this.ge.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r}),this.Me.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r})}}class Bt{constructor(){this.Et=null,this.Gn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;if(this.Gn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Et.Kn,i),this.Gn>=2){Math.floor(i)%2!=this.Gn%2&&this.Gn--}const e=this.Et.Is;this.Et.Se&&this.ye(t,e,this.Et.it,i),this.Et.ci&&this.ke(t,e,this.Et.it,this.Et.Kn,i);const r=this.Ce(i);(!this.Et.ci||this.Gn>2*r)&&this.xe(t,e,this.Et.it,i)}ye(t,i,s,n){if(null===this.Et)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Et.Kn*n));r=Math.max(Math.floor(n),Math.min(r,this.Gn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Te!==e&&(t.fillStyle=s.Te,e=s.Te);const o=Math.round(Math.min(s.re,s.he)*n),_=Math.round(Math.max(s.re,s.he)*n),u=Math.round(s.se*n),c=Math.round(s.ne*n);let d=Math.round(n*s.nt)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}Ce(t){let i=Math.floor(1*t);this.Gn<=2*i&&(i=Math.floor(.5*(this.Gn-1)));const s=Math.max(Math.floor(t),i);return this.Gn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}ke(t,i,s,n,e){if(null===this.Et)return;let r="";const h=this.Ce(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.De!==r&&(t.fillStyle=s.De,r=s.De);let a=Math.round(s.nt*e)-Math.floor(.5*this.Gn);const o=a+this.Gn-1,_=Math.round(Math.min(s.re,s.he)*e),u=Math.round(Math.max(s.re,s.he)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Et.Kn*e>2*h)N(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}xe(t,i,s,n){if(null===this.Et)return;let e="";const r=this.Ce(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.re,s.he)*n),a=Math.round(Math.max(s.re,s.he)*n),o=Math.round(s.nt*n)-Math.floor(.5*this.Gn),_=o+this.Gn-1;if(s.ie!==e){const i=s.ie;t.fillStyle=i,e=i}this.Et.ci&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class Vt extends Tt{constructor(){super(...arguments),this.An=new Bt}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Is:this.Cn,Kn:this.Dn.yt().Kn(),Se:t.wickVisible,ci:t.borderVisible,it:this.xn})}}class Nt{constructor(){this.Et=null,this.Pe=[]}tt(t){this.Et=t,this.Pe=[]}X(t,i,s,n){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return;this.Pe.length||this.Re(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Et.Ae*i)-Math.floor(e/2),h=r+e;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s],l=this.Pe[s-this.Et.it.from],a=Math.round(n.et*i);let o,_;t.fillStyle=n.ie,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.gn,o,l.Mn-l.gn+1,_-o)}}Re(t){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return void(this.Pe=[]);const i=Math.ceil(this.Et.Kn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Et.Kn*t)-i;this.Pe=new Array(this.Et.it.to-this.Et.it.from);for(let i=this.Et.it.from;i<this.Et.it.to;i++){const n=this.Et.st[i],e=Math.round(n.nt*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.Pe[i-this.Et.it.from]={gn:r,Mn:h,Oe:e,Le:n.nt*t,ot:n.ot}}for(let t=this.Et.it.from+1;t<this.Et.it.to;t++){const s=this.Pe[t-this.Et.it.from],n=this.Pe[t-this.Et.it.from-1];s.ot===n.ot+1&&(s.gn-n.Mn!==i+1&&(n.Oe>n.Le?n.Mn=s.gn-i-1:s.gn=n.Mn+i+1))}let n=Math.ceil(this.Et.Kn*t);for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn<i.gn&&(i.Mn=i.gn);const s=i.Mn-i.gn+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn-i.gn+1>n&&(i.Oe>i.Le?i.Mn-=1:i.gn+=1)}}}class Ft extends kt{constructor(){super(...arguments),this.An=new Nt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(){const t={st:this.Cn,Kn:this.Dn.yt().Kn(),it:this.xn,Ae:this.Tn.Pt().Dt(this.Tn.F().base,l(this.Tn.xt()).Rt)};this.An.tt(t)}}class Wt extends kt{constructor(){super(...arguments),this.An=new mt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(){const t=this.Tn.F(),i={st:this.Cn,Wt:t.lineStyle,cn:t.lineType,Ft:t.lineWidth,it:this.xn,un:this.Dn.yt().Kn()};this.An.tt(i)}}const zt=/[2-9]/g;class jt{constructor(t=50){this.Ee=0,this.Ie=1,this.Be=1,this.Ve={},this.Ne=new Map,this.Fe=t}We(){this.Ee=0,this.Ne.clear(),this.Ie=1,this.Be=1,this.Ve={}}Mi(t,i,s){return this.ze(t,i,s).width}gi(t,i,s){const n=this.ze(t,i,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}ze(t,i,s){const n=s||zt,e=String(i).replace(n,"0");if(this.Ne.has(e))return h(this.Ne.get(e)).je;if(this.Ee===this.Fe){const t=this.Ve[this.Be];delete this.Ve[this.Be],this.Ne.delete(t),this.Be++,this.Ee--}t.save(),t.textBaseline="middle";const r=t.measureText(e);return t.restore(),0===r.width&&i.length||(this.Ne.set(e,{je:r,$e:this.Ie}),this.Ve[this.Ie]=e,this.Ee++,this.Ie++),r}}class $t{constructor(t){this.He=null,this.S=null,this.Ue="right",this.qe=0,this.Ye=t}Xe(t,i,s,n){this.He=t,this.S=i,this.qe=s,this.Ue=n}X(t,i){null!==this.S&&null!==this.He&&this.He.X(t,this.S,this.Ye,this.qe,this.Ue,i)}}class Ht{constructor(t,i,s){this.Ze=t,this.Ye=new jt(50),this.Ke=i,this.N=s,this.W=-1,this.jt=new $t(this.Ye)}gt(t,i){const s=this.N.Ge(this.Ke);if(null===s)return null;const n=s.Je(this.Ke)?s.Qe():this.Ke.Pt();if(null===n)return null;const e=s.tr(n);if("overlay"===e)return null;const r=this.N.ir();return r.T!==this.W&&(this.W=r.T,this.Ye.We()),this.jt.Xe(this.Ze.Ii(),r,i,e),this.jt}}class Ut{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,r){if(null===this.Et)return;if(!1===this.Et.Ct)return;const h=Math.round(this.Et.et*i);if(h<0||h>Math.ceil(this.Et.Zt*i))return;const l=Math.ceil(this.Et.Xt*i);t.lineCap="butt",t.strokeStyle=this.Et.R,t.lineWidth=Math.floor(this.Et.Ft*i),n(t,this.Et.Wt),e(t,h,0,l)}}class qt{constructor(t){this.sr={Xt:0,Zt:0,et:0,R:"rgba(0, 0, 0, 0)",Ft:1,Wt:0,Ct:!1},this.nr=new Ut,this.ft=!0,this.Tn=t,this.Dn=t.Ut(),this.nr.tt(this.sr)}bt(){this.ft=!0}gt(t,i){return this.Tn.Ct()?(this.ft&&(this.er(t,i),this.ft=!1),this.nr):null}}class Yt extends qt{constructor(t){super(t)}er(t,i){this.sr.Ct=!1;const s=this.Tn.Pt(),n=s.rr().rr;if(2!==n&&3!==n)return;const e=this.Tn.F();if(!e.baseLineVisible||!this.Tn.Ct())return;const r=this.Tn.xt();null!==r&&(this.sr.Ct=!0,this.sr.et=s.Dt(r.Rt,r.Rt),this.sr.Xt=i,this.sr.Zt=t,this.sr.R=e.baseLineColor,this.sr.Ft=e.baseLineWidth,this.sr.Wt=e.baseLineStyle)}}class Xt{constructor(){this.Et=null}tt(t){this.Et=t}hr(){return this.Et}X(t,i,s,n){const e=this.Et;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.Le.x*i)+h,a=e.Le.y*i;t.fillStyle=e.lr,t.beginPath();const o=Math.max(2,1.5*e.ar)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e._r,t.beginPath(),t.arc(l,a,e.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.ur,t.beginPath(),t.arc(l,a,e.ht*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Zt=[{cr:0,dr:.25,pr:4,vr:10,mr:.25,br:0,wr:.4,gr:.8},{cr:.25,dr:.525,pr:10,vr:14,mr:0,br:0,wr:.8,gr:0},{cr:.525,dr:1,pr:14,vr:14,mr:0,br:0,wr:0,gr:0}];function Kt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=v(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Gt(t,i){const s=t%2600/2600;let n;for(const t of Zt)if(s>=t.cr&&s<=t.dr){n=t;break}r(void 0!==n,"Last price animation internal logic error");const e=(s-n.cr)/(n.dr-n.cr);return{_r:Kt(i,e,n.mr,n.br),ur:Kt(i,e,n.wr,n.gr),ht:(h=e,l=n.pr,a=n.vr,l+(a-l)*h)};var h,l,a}class Jt{constructor(t){this.jt=new Xt,this.ft=!0,this.Mr=!0,this.Sr=performance.now(),this.yr=this.Sr-1,this.kr=t}Cr(){this.yr=this.Sr-1,this.bt()}Tr(){if(this.bt(),2===this.kr.F().lastPriceAnimation){const t=performance.now(),i=this.yr-t;if(i>0)return void(i<650&&(this.yr+=2600));this.Sr=t,this.yr=t+2600}}bt(){this.ft=!0}Dr(){this.Mr=!0}Ct(){return 0!==this.kr.F().lastPriceAnimation}Pr(){switch(this.kr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.yr}}gt(t,i){return this.ft?(this.Mt(t,i),this.ft=!1,this.Mr=!1):this.Mr&&(this.Rr(),this.Mr=!1),this.jt}Mt(t,i){this.jt.tt(null);const s=this.kr.Ut().yt(),n=s.Nn(),e=this.kr.xt();if(null===n||null===e)return;const r=this.kr.Ar(!0);if(r.Or||!n.Lr(r.Yn))return;const h={x:s.Lt(r.Yn),y:this.kr.Pt().Dt(r._t,e.Rt)},l=r.R,a=this.kr.F().lineWidth,o=Gt(this.Er(),l);this.jt.tt({lr:l,ar:a,_r:o._r,ur:o.ur,ht:o.ht,Le:h})}Rr(){const t=this.jt.hr();if(null!==t){const i=Gt(this.Er(),t.lr);t._r=i._r,t.ur=i.ur,t.ht=i.ht}}Er(){return this.Pr()?performance.now()-this.Sr:2599}}function Qt(t,i){return Ot(Math.min(Math.max(t,12),30)*i)}function ti(t,i){switch(t){case"arrowDown":case"arrowUp":return Qt(i,1);case"circle":return Qt(i,.8);case"square":return Qt(i,.7)}}function ii(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(Qt(t,1))}function si(t){return Math.max(Qt(t,.1),3)}function ni(t,i,s,n,e){const r=ti("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function ei(t,i,s,n,e){const r=(ti("arrowUp",e)-1)/2,h=(Ot(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function ri(t,i,s,n,e,r){return ni(i,s,n,e,r)}class hi extends A{constructor(){super(...arguments),this.Et=null,this.Ye=new jt,this.W=-1,this.j="",this.Ir=""}tt(t){this.Et=t}Xe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Ir=D(t,i),this.Ye.We())}Br(t,i){if(null===this.Et||null===this.Et.it)return null;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s];if(ai(n,t,i))return{Vr:n.Nr,Fr:n.Fr}}return null}Z(t,i,s){if(null!==this.Et&&null!==this.Et.it){t.textBaseline="middle",t.font=this.Ir;for(let i=this.Et.it.from;i<this.Et.it.to;i++){const s=this.Et.st[i];void 0!==s.ti&&(s.ti.Xt=this.Ye.Mi(t,s.ti.Wr),s.ti.Zt=this.W),li(s,t)}}}}function li(t,i){i.fillStyle=t.R,void 0!==t.ti&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.ti.Wr,t.nt-t.ti.Xt/2,t.ti.et),function(t,i){if(0===t.Fn)return;switch(t.zr){case"arrowDown":return void ei(!1,i,t.nt,t.et,t.Fn);case"arrowUp":return void ei(!0,i,t.nt,t.et,t.Fn);case"circle":return void function(t,i,s,n){const e=(ti("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.Fn);case"square":return void function(t,i,s,n){const e=ti("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.nt,t.et,t.Fn)}t.zr}(t,i)}function ai(t,i,s){return!(void 0===t.ti||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.nt,t.ti.et,t.ti.Xt,t.ti.Zt,i,s))||function(t,i,s){if(0===t.Fn)return!1;switch(t.zr){case"arrowDown":case"arrowUp":return ri(0,t.nt,t.et,t.Fn,i,s);case"circle":return function(t,i,s,n,e){const r=2+ti("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.nt,t.et,t.Fn,i,s);case"square":return ni(t.nt,t.et,t.Fn,i,s)}}(t,i,s)}function oi(t,i,s,n,e,r,h,l,a){const o=g(s)?s:s.ce,_=g(s)?s:s._e,u=g(s)?s:s.ue,c=g(i.size)?Math.max(i.size,0):1,d=ii(l.Kn())*c,f=d/2;switch(t.Fn=d,i.position){case"inBar":return t.et=h.Dt(o,a),void(void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e));case"aboveBar":return t.et=h.Dt(_,a)-f-n.jr,void 0!==t.ti&&(t.ti.et=t.et-f-.6*e,n.jr+=1.2*e),void(n.jr+=d+r);case"belowBar":return t.et=h.Dt(u,a)+f+n.$r,void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e,n.$r+=1.2*e),void(n.$r+=d+r)}i.position}class _i{constructor(t,i){this.ft=!0,this.Hr=!0,this.Ur=!0,this.qr=null,this.jt=new hi,this.kr=t,this.$i=i,this.Et={st:[],it:null}}bt(t){this.ft=!0,this.Ur=!0,"data"===t&&(this.Hr=!0)}gt(t,i,s){if(!this.kr.Ct())return null;this.ft&&this.Yr();const n=this.$i.F().layout;return this.jt.Xe(n.fontSize,n.fontFamily),this.jt.tt(this.Et),this.jt}Xr(){if(this.Ur){if(this.kr.Zr().length>0){const t=this.$i.yt().Kn(),i=si(t),s=1.5*ii(t)+2*i;this.qr={above:s,below:s}}else this.qr=null;this.Ur=!1}return this.qr}Yr(){const t=this.kr.Pt(),i=this.$i.yt(),s=this.kr.Zr();this.Hr&&(this.Et.st=s.map((t=>({ot:t.time,nt:0,et:0,Fn:0,zr:t.shape,R:t.color,Nr:t.internalId,Fr:t.id,ti:void 0}))),this.Hr=!1);const n=this.$i.F().layout;this.Et.it=null;const e=i.Nn();if(null===e)return;const r=this.kr.xt();if(null===r)return;if(0===this.Et.st.length)return;let h=NaN;const l=si(i.Kn()),a={jr:l,$r:l};this.Et.it=St(this.Et.st,e,!0);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const o=s[e];o.time!==h&&(a.jr=l,a.$r=l,h=o.time);const _=this.Et.st[e];_.nt=i.Lt(o.time),void 0!==o.text&&o.text.length>0&&(_.ti={Wr:o.text,et:0,Xt:0,Zt:0});const u=this.kr.Kr(o.time);null!==u&&oi(_,o,u,a,n.fontSize,l,t,i,r.Rt)}this.ft=!1}}class ui extends qt{constructor(t){super(t)}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Tn.F();if(!n.priceLineVisible||!this.Tn.Ct())return;const e=this.Tn.Ar(0===n.priceLineSource);e.Or||(s.Ct=!0,s.et=e.yi,s.R=this.Tn.Gr(e.R),s.Xt=i,s.Zt=t,s.Ft=n.priceLineWidth,s.Wt=n.priceLineStyle)}}class ci extends q{constructor(t){super(),this.$t=t}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.$t;if(!n.Ct())return;const e=n.F(),r=e.lastValueVisible,h=""!==n.Jr(),l=0===e.seriesLastValueMode,a=n.Ar(!1);if(a.Or)return;r&&(t.ti=this.Qr(a,r,l),t.Ct=0!==t.ti.length),(h||l)&&(i.ti=this.th(a,r,h,l),i.Ct=i.ti.length>0);const o=n.Gr(a.R),_=m(o);s.t=_.t,s.R=_.i,s.yi=a.yi,i.At=n.Ut().Ot(a.yi/n.Pt().Zt()),t.At=o,t.R=s.R,i.R=s.R}th(t,i,s,n){let e="";const r=this.$t.Jr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.$t.Pt().ih()?t.sh:t.nh),e.trim()}Qr(t,i,s){return i?s?this.$t.Pt().ih()?t.nh:t.sh:t.ti:""}}class di{constructor(t,i){this.eh=t,this.rh=i}hh(t){return null!==t&&(this.eh===t.eh&&this.rh===t.rh)}lh(){return new di(this.eh,this.rh)}ah(){return this.eh}oh(){return this.rh}_h(){return this.rh-this.eh}Fi(){return this.rh===this.eh||Number.isNaN(this.rh)||Number.isNaN(this.eh)}tn(t){return null===t?this:new di(Math.min(this.ah(),t.ah()),Math.max(this.oh(),t.oh()))}uh(t){if(!g(t))return;if(0===this.rh-this.eh)return;const i=.5*(this.rh+this.eh);let s=this.rh-i,n=this.eh-i;s*=t,n*=t,this.rh=i+s,this.eh=i+n}dh(t){g(t)&&(this.rh+=t,this.eh+=t)}fh(){return{minValue:this.eh,maxValue:this.rh}}static ph(t){return null===t?null:new di(t.minValue,t.maxValue)}}class fi{constructor(t,i){this.mh=t,this.bh=i||null}wh(){return this.mh}gh(){return this.bh}fh(){return null===this.mh?null:{priceRange:this.mh.fh(),margins:this.bh||void 0}}static ph(t){return null===t?null:new fi(di.ph(t.priceRange),t.margins)}}class pi extends qt{constructor(t,i){super(t),this.Mh=i}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Mh.F();if(!this.Tn.Ct()||!n.lineVisible)return;const e=this.Mh.Sh();null!==e&&(s.Ct=!0,s.et=e,s.R=n.color,s.Xt=i,s.Zt=t,s.Ft=n.lineWidth,s.Wt=n.lineStyle)}}class vi extends q{constructor(t,i){super(),this.kr=t,this.Mh=i}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Mh.F(),e=n.axisLabelVisible,r=""!==n.title,h=this.kr;if(!e||!h.Ct())return;const l=this.Mh.Sh();if(null===l)return;r&&(i.ti=n.title,i.Ct=!0),i.At=h.Ut().Ot(l/h.Pt().Zt()),t.ti=this.yh(n.price),t.Ct=!0;const a=m(n.color);s.t=a.t,s.R=a.i,s.yi=l}yh(t){const i=this.kr.xt();return null===i?"":this.kr.Pt().Wi(t,i.Rt)}}class mi{constructor(t,i){this.kr=t,this.us=i,this.kh=new pi(t,this),this.Ze=new vi(t,this),this.Ch=new Ht(this.Ze,t,t.Ut())}xh(t){w(this.us,t),this.bt(),this.kr.Ut().Th()}F(){return this.us}Dh(){return this.kh}Ph(){return this.Ch}Rh(){return this.Ze}bt(){this.kh.bt(),this.Ze.bt()}Sh(){const t=this.kr,i=t.Pt();if(t.Ut().yt().Fi()||i.Fi())return null;const s=t.xt();return null===s?null:i.Dt(this.us.price,s.Rt)}}class bi extends G{constructor(t){super(),this.$i=t}Ut(){return this.$i}}const wi={Bar:(t,i,s,n)=>{var e;const r=i.upColor,h=i.downColor,o=l(t(s,n)),_=a(o.Rt[0])<=a(o.Rt[3]);return{ie:null!==(e=o.R)&&void 0!==e?e:_?r:h}},Candlestick:(t,i,s,n)=>{var e,r,h;const o=i.upColor,_=i.downColor,u=i.borderUpColor,c=i.borderDownColor,d=i.wickUpColor,f=i.wickDownColor,p=l(t(s,n)),v=a(p.Rt[0])<=a(p.Rt[3]);return{ie:null!==(e=p.R)&&void 0!==e?e:v?o:_,De:null!==(r=p.At)&&void 0!==r?r:v?u:c,Te:null!==(h=p.Ah)&&void 0!==h?h:v?d:f}},Area:(t,i,s,n)=>{var e,r,h,a;const o=l(t(s,n));return{ie:null!==(e=o.lt)&&void 0!==e?e:i.lineColor,lt:null!==(r=o.lt)&&void 0!==r?r:i.lineColor,vn:null!==(h=o.vn)&&void 0!==h?h:i.topColor,mn:null!==(a=o.mn)&&void 0!==a?a:i.bottomColor}},Baseline:(t,i,s,n)=>{var e,r,h,a,o,_;const u=l(t(s,n));return{ie:u.Rt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,be:null!==(e=u.be)&&void 0!==e?e:i.topLineColor,we:null!==(r=u.we)&&void 0!==r?r:i.bottomLineColor,de:null!==(h=u.de)&&void 0!==h?h:i.topFillColor1,fe:null!==(a=u.fe)&&void 0!==a?a:i.topFillColor2,pe:null!==(o=u.pe)&&void 0!==o?o:i.bottomFillColor1,ve:null!==(_=u.ve)&&void 0!==_?_:i.bottomFillColor2}},Line:(t,i,s,n)=>{var e,r;const h=l(t(s,n));return{ie:null!==(e=h.R)&&void 0!==e?e:i.color,lt:null!==(r=h.R)&&void 0!==r?r:i.color}},Histogram:(t,i,s,n)=>{var e;return{ie:null!==(e=l(t(s,n)).R)&&void 0!==e?e:i.color}}};class gi{constructor(t){this.Oh=(t,i)=>void 0!==i?i.Rt:this.kr.Is().Lh(t),this.kr=t,this.Eh=wi[t.Ih()]}Ln(t,i){return this.Eh(this.Oh,this.kr.F(),t,i)}}var Mi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(Mi||(Mi={}));const Si=30;class yi{constructor(){this.Bh=[],this.Vh=new Map,this.Nh=new Map}Fh(){return this.Fn()>0?this.Bh[this.Bh.length-1]:null}Wh(){return this.Fn()>0?this.zh(0):null}Es(){return this.Fn()>0?this.zh(this.Bh.length-1):null}Fn(){return this.Bh.length}Fi(){return 0===this.Fn()}Lr(t){return null!==this.jh(t,0)}Lh(t){return this.$h(t)}$h(t,i=0){const s=this.jh(t,i);return null===s?null:Object.assign(Object.assign({},this.Hh(s)),{Yn:this.zh(s)})}Un(){return this.Bh}Uh(t,i,s){if(this.Fi())return null;let n=null;for(const e of s){n=ki(n,this.qh(t,i,e))}return n}tt(t){this.Nh.clear(),this.Vh.clear(),this.Bh=t}zh(t){return this.Bh[t].Yn}Hh(t){return this.Bh[t]}jh(t,i){const s=this.Yh(t);if(null===s&&0!==i)switch(i){case-1:return this.Xh(t);case 1:return this.Zh(t);default:throw new TypeError("Unknown search mode")}return s}Xh(t){let i=this.Kh(t);return i>0&&(i-=1),i!==this.Bh.length&&this.zh(i)<t?i:null}Zh(t){const i=this.Gh(t);return i!==this.Bh.length&&t<this.zh(i)?i:null}Yh(t){const i=this.Kh(t);return i===this.Bh.length||t<this.Bh[i].Yn?null:i}Kh(t){return bt(this.Bh,t,((t,i)=>t.Yn<i))}Gh(t){return wt(this.Bh,t,((t,i)=>i.Yn>t))}Jh(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.Bh[e].Rt[s];Number.isNaN(t)||(null===n?n={Qh:t,tl:t}:(t<n.Qh&&(n.Qh=t),t>n.tl&&(n.tl=t)))}return n}qh(t,i,s){if(this.Fi())return null;let n=null;const e=l(this.Wh()),r=l(this.Es()),h=Math.max(t,e),a=Math.min(i,r),o=Math.ceil(h/Si)*Si,_=Math.max(o,Math.floor(a/Si)*Si);{const t=this.Kh(h),e=this.Gh(Math.min(a,o,i));n=ki(n,this.Jh(t,e,s))}let u=this.Vh.get(s);void 0===u&&(u=new Map,this.Vh.set(s,u));for(let t=Math.max(o+1,h);t<_;t+=Si){const i=Math.floor(t/Si);let e=u.get(i);if(void 0===e){const t=this.Kh(i*Si),n=this.Gh((i+1)*Si-1);e=this.Jh(t,n,s),u.set(i,e)}n=ki(n,e)}{const t=this.Kh(_),i=this.Gh(a);n=ki(n,this.Jh(t,i,s))}return n}}function ki(t,i){if(null===t)return i;if(null===i)return t;return{Qh:Math.min(t.Qh,i.Qh),tl:Math.max(t.tl,i.tl)}}class Ci extends bi{constructor(t,i,s){super(t),this.Et=new yi,this.kh=new ui(this),this.il=[],this.sl=new Yt(this),this.nl=null,this.el=null,this.rl=[],this.hl=[],this.ll=null,this.us=i,this.al=s;const n=new ci(this);this.es=[n],this.Ch=new Ht(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.nl=new Jt(this)),this.ol(),this._l()}M(){null!==this.ll&&clearTimeout(this.ll)}Gr(t){return this.us.priceLineColor||t}Ar(t){const i={Or:!0},s=this.Pt();if(this.Ut().yt().Fi()||s.Fi()||this.Et.Fi())return i;const n=this.Ut().yt().Nn(),e=this.xt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Et.Fh();if(null===t)return i;r=t,h=t.Yn}else{const t=this.Et.$h(n.Mn(),-1);if(null===t)return i;if(r=this.Et.Lh(t.Yn),null===r)return i;h=t.Yn}const l=r.Rt[3],a=this.En().Ln(h,{Rt:r}),o=s.Dt(l,e.Rt);return{Or:!1,_t:l,ti:s.Wi(l,e.Rt),sh:s.ul(l),nh:s.cl(l,e.Rt),R:a.ie,yi:o,Yn:h}}En(){return null!==this.el||(this.el=new gi(this)),this.el}F(){return this.us}xh(t){const i=t.priceScaleId;void 0!==i&&i!==this.us.priceScaleId&&this.Ut().dl(this,i),w(this.us,t),void 0!==t.priceFormat&&(this.ol(),this.Ut().fl()),this.Ut().pl(this),this.Ut().vl(),this.ws.bt("options")}tt(t,i){this.Et.tt(t),this.ml(),this.ws.bt("data"),this.cs.bt("data"),null!==this.nl&&(i&&i.bl?this.nl.Tr():0===t.length&&this.nl.Cr());const s=this.Ut().Ge(this);this.Ut().wl(s),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}gl(t){this.rl=t,this.ml();const i=this.Ut().Ge(this);this.cs.bt("data"),this.Ut().wl(i),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}Ml(){return this.rl}Zr(){return this.hl}Sl(t){const i=new mi(this,t);return this.il.push(i),this.Ut().pl(this),i}yl(t){const i=this.il.indexOf(t);-1!==i&&this.il.splice(i,1),this.Ut().pl(this)}Ih(){return this.al}xt(){const t=this.kl();return null===t?null:{Rt:t.Rt[3],Cl:t.ot}}kl(){const t=this.Ut().yt().Nn();if(null===t)return null;const i=t.gn();return this.Et.$h(i,1)}Is(){return this.Et}Kr(t){const i=this.Et.Lh(t);return null===i?null:"Bar"===this.al||"Candlestick"===this.al?{oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3]}:i.Rt[3]}xl(t){const i=this.nl;return null!==i&&i.Ct()?(null===this.ll&&i.Pr()&&(this.ll=setTimeout((()=>{this.ll=null,this.Ut().Tl()}),0)),i.Dr(),[i]):[]}Ds(){const t=[];this.Dl()||t.push(this.sl),t.push(this.ws,this.kh,this.cs);const i=this.il.map((t=>t.Dh()));return t.push(...i),t}Gi(t){return[this.Ch,...this.il.map((t=>t.Ph()))]}Ps(t,i){if(i!==this.qi&&!this.Dl())return[];const s=[...this.es];for(const t of this.il)s.push(t.Rh());return s}Pl(t,i){if(void 0!==this.us.autoscaleInfoProvider){const s=this.us.autoscaleInfoProvider((()=>{const s=this.Rl(t,i);return null===s?null:s.fh()}));return fi.ph(s)}return this.Rl(t,i)}Al(){return this.us.priceFormat.minMove}Ol(){return this.Ll}As(){var t;this.ws.bt(),this.cs.bt();for(const t of this.es)t.bt();for(const t of this.il)t.bt();this.kh.bt(),this.sl.bt(),null===(t=this.nl)||void 0===t||t.bt()}Pt(){return l(super.Pt())}kt(t){if(!(("Line"===this.al||"Area"===this.al||"Baseline"===this.al)&&this.us.crosshairMarkerVisible))return null;const i=this.Et.Lh(t);if(null===i)return null;return{_t:i.Rt[3],ht:this.El(),At:this.Il(),Tt:this.Bl(t)}}Jr(){return this.us.title}Ct(){return this.us.visible}Dl(){return!tt(this.Pt().Vl())}Rl(t,i){if(!M(t)||!M(i)||this.Et.Fi())return null;const s="Line"===this.al||"Area"===this.al||"Baseline"===this.al||"Histogram"===this.al?[3]:[2,1],n=this.Et.Uh(t,i,s);let e=null!==n?new di(n.Qh,n.tl):null;if("Histogram"===this.Ih()){const t=this.us.base,i=new di(t,t);e=null!==e?e.tn(i):i}return new fi(e,this.cs.Xr())}El(){switch(this.al){case"Line":case"Area":case"Baseline":return this.us.crosshairMarkerRadius}return 0}Il(){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Bl(t){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.En().Ln(t).ie}ol(){switch(this.us.priceFormat.type){case"custom":this.Ll={format:this.us.priceFormat.formatter};break;case"volume":this.Ll=new ht(this.us.priceFormat.precision);break;case"percent":this.Ll=new rt(this.us.priceFormat.precision);break;default:{const t=Math.pow(10,this.us.priceFormat.precision);this.Ll=new et(t,this.us.priceFormat.minMove*t)}}null!==this.qi&&this.qi.Nl()}ml(){const t=this.Ut().yt();if(t.Fi()||0===this.Et.Fn())return void(this.hl=[]);const i=l(this.Et.Wh());this.hl=this.rl.map(((s,n)=>{const e=l(t.Fl(s.time,!0)),r=e<i?1:-1;return{time:l(this.Et.$h(e,r)).Yn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}_l(){switch(this.cs=new _i(this,this.Ut()),this.al){case"Bar":this.ws=new Dt(this,this.Ut());break;case"Candlestick":this.ws=new Vt(this,this.Ut());break;case"Line":this.ws=new Wt(this,this.Ut());break;case"Area":this.ws=new Ct(this,this.Ut());break;case"Baseline":this.ws=new It(this,this.Ut());break;case"Histogram":this.ws=new Ft(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.al)}}}class xi{constructor(t){this.us=t}Wl(t,i,s){let n=t;if(0===this.us.mode)return n;const e=s.fs(),r=e.xt();if(null===r)return n;const h=e.Dt(t,r),l=s.zl().filter((t=>t instanceof Ci)).reduce(((t,n)=>{if(s.Je(n)||!n.Ct())return t;const e=n.Pt(),r=n.Is();if(e.Fi()||!r.Lr(i))return t;const h=r.Lh(i);if(null===h)return t;const l=a(n.xt());return t.concat([e.Dt(h.Rt[3],l.Rt)])}),[]);if(0===l.length)return n;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=l[0];return n=e.ps(o,r),n}}class Ti{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,e){if(null===this.Et)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const h=Math.ceil(this.Et.Nt*i),a=Math.ceil(this.Et.Vt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=l(this.Et);if(s.jl){t.strokeStyle=s.$l,n(t,s.Hl),t.beginPath();for(const n of s.Ul){const s=Math.round(n.ql*i);t.moveTo(s,-r),t.lineTo(s,h+r)}t.stroke()}if(s.Yl){t.strokeStyle=s.Xl,n(t,s.Zl),t.beginPath();for(const n of s.Kl){const s=Math.round(n.ql*i);t.moveTo(-r,s),t.lineTo(a+r,s)}t.stroke()}}))}}class Di{constructor(t){this.jt=new Ti,this.ft=!0,this.Qi=t}bt(){this.ft=!0}gt(t,i){if(this.ft){const s=this.Qi.Ut().F().grid,n={Nt:t,Vt:i,Yl:s.horzLines.visible,jl:s.vertLines.visible,Xl:s.horzLines.color,$l:s.vertLines.color,Zl:s.horzLines.style,Hl:s.vertLines.style,Kl:this.Qi.fs().Gl(),Ul:this.Qi.Ut().yt().Gl()||[]};this.jt.tt(n),this.ft=!1}return this.jt}}class Pi{constructor(t){this.ws=new Di(t)}Dh(){return this.ws}}const Ri={Jl:4,Ql:1e-4};function Ai(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Oi(t,i){const s=Ai(t.ah(),i),n=Ai(t.oh(),i);return new di(s,n)}function Li(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ei(t,i){const s=Li(t.ah(),i),n=Li(t.oh(),i);return new di(s,n)}function Ii(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=At(s+i.Ql)+i.Jl;return t<0?-n:n}function Bi(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Jl)-i.Ql;return t<0?-n:n}function Vi(t,i){if(null===t)return null;const s=Ii(t.ah(),i),n=Ii(t.oh(),i);return new di(s,n)}function Ni(t,i){if(null===t)return null;const s=Bi(t.ah(),i),n=Bi(t.oh(),i);return new di(s,n)}function Fi(t){if(null===t)return Ri;const i=Math.abs(t.oh()-t.ah());if(i>=1||i<1e-15)return Ri;const s=Math.ceil(Math.abs(Math.log10(i))),n=Ri.Jl+s;return{Jl:n,Ql:1/Math.pow(10,n)}}class Wi{constructor(t,i){if(this.ta=t,this.ia=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.ta))this.sa=[2,2.5,2];else{this.sa=[];for(let t=this.ta;1!==t;){if(t%2==0)this.sa.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.sa.push(2,2.5),t/=5}if(this.sa.length>100)throw new Error("something wrong with base")}}}na(t,i,s){const n=0===this.ta?0:1/this.ta;let e=Math.pow(10,Math.max(0,Math.ceil(At(t-i)))),r=0,h=this.ia[0];for(;;){const t=Rt(e,n,1e-14)&&e>n+1e-14,i=Rt(e,s*h,1e-14),l=Rt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.ia[++r%this.ia.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.sa.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.sa[0];Rt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.sa[++r%this.sa.length];var l,a,o;return e}}class zi{constructor(t,i,s,n){this.ea=[],this.Vi=t,this.ta=i,this.ra=s,this.ha=n}na(t,i){if(t<i)throw new Error("high < low");const s=this.Vi.Zt(),n=(t-i)*this.la()/s,e=new Wi(this.ta,[2,2.5,2]),r=new Wi(this.ta,[2,2,2.5]),h=new Wi(this.ta,[2.5,2,2]),l=[];return l.push(e.na(t,i,n),r.na(t,i,n),h.na(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}aa(){const t=this.Vi,i=t.xt();if(null===i)return void(this.ea=[]);const s=t.Zt(),n=this.ra(s-1,i),e=this.ra(0,i),r=this.Vi.F().entireTextOnly?this.oa()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.ea=[]);let _=this.na(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.ha(s,i,!0);null!==d&&Math.abs(n-d)<this.la()||(n<h||n>l||(f<this.ea.length?(this.ea[f].ql=n,this.ea[f]._a=t.ua(s)):this.ea.push({ql:n,_a:t.ua(s)}),f++,d=n,t.ca()&&(_=this.na(s*c,o))))}this.ea.length=f}Gl(){return this.ea}oa(){return this.Vi.T()}la(){return Math.ceil(2.5*this.oa())}}function ji(t){return t.slice().sort(((t,i)=>l(t.Xi())-l(i.Xi())))}var $i;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}($i||($i={}));const Hi=new rt,Ui=new et(100,1);class qi{constructor(t,i,s,n){this.da=0,this.fa=null,this.mh=null,this.pa=null,this.va={ma:!1,ba:null},this.wa=0,this.ga=0,this.Ma=new b,this.Sa=new b,this.ya=[],this.ka=null,this.Ca=null,this.xa=null,this.Ta=null,this.Ll=Ui,this.Da=Fi(null),this.Pa=t,this.us=i,this.Ra=s,this.Aa=n,this.Oa=new zi(this,100,this.La.bind(this),this.Ea.bind(this))}Vl(){return this.Pa}F(){return this.us}xh(t){if(w(this.us,t),this.Nl(),void 0!==t.mode&&this.Ia({rr:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Ba(),this.Ca=null}}Va(){return this.us.autoScale}ca(){return 1===this.us.mode}ih(){return 2===this.us.mode}Na(){return 3===this.us.mode}rr(){return{zs:this.us.autoScale,Fa:this.us.invertScale,rr:this.us.mode}}Ia(t){const i=this.rr();let s=null;void 0!==t.zs&&(this.us.autoScale=t.zs),void 0!==t.rr&&(this.us.mode=t.rr,2!==t.rr&&3!==t.rr||(this.us.autoScale=!0),this.va.ma=!1),1===i.rr&&t.rr!==i.rr&&(!function(t,i){if(null===t)return!1;const s=Bi(t.ah(),i),n=Bi(t.oh(),i);return isFinite(s)&&isFinite(n)}(this.mh,this.Da)?this.us.autoScale=!0:(s=Ni(this.mh,this.Da),null!==s&&this.Wa(s))),1===t.rr&&t.rr!==i.rr&&(s=Vi(this.mh,this.Da),null!==s&&this.Wa(s));const n=i.rr!==this.us.mode;n&&(2===i.rr||this.ih())&&this.Nl(),n&&(3===i.rr||this.Na())&&this.Nl(),void 0!==t.Fa&&i.Fa!==t.Fa&&(this.us.invertScale=t.Fa,this.za()),this.Sa.m(i,this.rr())}ja(){return this.Sa}T(){return this.Ra.fontSize}Zt(){return this.da}$a(t){this.da!==t&&(this.da=t,this.Ba(),this.Ca=null)}Ha(){if(this.fa)return this.fa;const t=this.Zt()-this.Ua()-this.qa();return this.fa=t,t}wh(){return this.Ya(),this.mh}Wa(t,i){const s=this.mh;(i||null===s&&null!==t||null!==s&&!s.hh(t))&&(this.Ca=null,this.mh=t)}Fi(){return this.Ya(),0===this.da||!this.mh||this.mh.Fi()}Xa(t){return this.Fa()?t:this.Zt()-1-t}Dt(t,i){return this.ih()?t=Ai(t,i):this.Na()&&(t=Li(t,i)),this.Ea(t,i)}$n(t,i,s){this.Ya();const n=this.qa(),e=l(this.wh()),r=e.ah(),h=e.oh(),a=this.Ha()-1,o=this.Fa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s],h=e._t;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e._t,i));const a=n+_*(l-r),u=o?a:this.da-1-a;e.et=u}}le(t,i,s){this.Ya();const n=this.qa(),e=l(this.wh()),r=e.ah(),h=e.oh(),a=this.Ha()-1,o=this.Fa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s];let h=e.oe,l=e._e,a=e.ue,u=e.ce;null!==d&&(h=d(e.oe,i),l=d(e._e,i),a=d(e.ue,i),u=d(e.ce,i));let c=n+_*(h-r),f=o?c:this.da-1-c;e.re=f,c=n+_*(l-r),f=o?c:this.da-1-c,e.se=f,c=n+_*(a-r),f=o?c:this.da-1-c,e.ne=f,c=n+_*(u-r),f=o?c:this.da-1-c,e.he=f}}ps(t,i){const s=this.La(t,i);return this.Ka(s,i)}Ka(t,i){let s=t;return this.ih()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Na()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}zl(){return this.ya}Ga(){if(this.ka)return this.ka;let t=[];for(let i=0;i<this.ya.length;i++){const s=this.ya[i];null===s.Xi()&&s.Zi(i+1),t.push(s)}return t=ji(t),this.ka=t,this.ka}Ja(t){-1===this.ya.indexOf(t)&&(this.ya.push(t),this.Nl(),this.Qa())}io(t){const i=this.ya.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ya.splice(i,1),0===this.ya.length&&(this.Ia({zs:!0}),this.Wa(null)),this.Nl(),this.Qa()}xt(){let t=null;for(const i of this.ya){const s=i.xt();null!==s&&((null===t||s.Cl<t.Cl)&&(t=s))}return null===t?null:t.Rt}Fa(){return this.us.invertScale}Gl(){const t=null===this.xt();if(null!==this.Ca&&(t||this.Ca.so===t))return this.Ca.Gl;this.Oa.aa();const i=this.Oa.Gl();return this.Ca={Gl:i,so:t},this.Ma.m(),i}no(){return this.Ma}eo(t){this.ih()||this.Na()||null===this.xa&&null===this.pa&&(this.Fi()||(this.xa=this.da-t,this.pa=l(this.wh()).lh()))}ro(t){if(this.ih()||this.Na())return;if(null===this.xa)return;this.Ia({zs:!1}),(t=this.da-t)<0&&(t=0);let i=(this.xa+.2*(this.da-1))/(t+.2*(this.da-1));const s=l(this.pa).lh();i=Math.max(i,.1),s.uh(i),this.Wa(s)}ho(){this.ih()||this.Na()||(this.xa=null,this.pa=null)}lo(t){this.Va()||null===this.Ta&&null===this.pa&&(this.Fi()||(this.Ta=t,this.pa=l(this.wh()).lh()))}ao(t){if(this.Va())return;if(null===this.Ta)return;const i=l(this.wh())._h()/(this.Ha()-1);let s=t-this.Ta;this.Fa()&&(s*=-1);const n=s*i,e=l(this.pa).lh();e.dh(n),this.Wa(e,!0),this.Ca=null}oo(){this.Va()||null!==this.Ta&&(this.Ta=null,this.pa=null)}Ol(){return this.Ll||this.Nl(),this.Ll}Wi(t,i){switch(this.us.mode){case 2:return this.Ol().format(Ai(t,i));case 3:return this.Ol().format(Li(t,i));default:return this.yh(t)}}ua(t){switch(this.us.mode){case 2:case 3:return this.Ol().format(t);default:return this.yh(t)}}ul(t){return this.yh(t,l(this._o()).Ol())}cl(t,i){return t=Ai(t,i),Hi.format(t)}uo(){return this.ya}co(t){this.va={ba:t,ma:!1}}As(){this.ya.forEach((t=>t.As()))}Nl(){this.Ca=null;const t=this._o();let i=100;null!==t&&(i=Math.round(1/t.Al())),this.Ll=Ui,this.ih()?(this.Ll=Hi,i=100):this.Na()?(this.Ll=new et(100,1),i=100):null!==t&&(this.Ll=t.Ol()),this.Oa=new zi(this,i,this.La.bind(this),this.Ea.bind(this)),this.Oa.aa()}Qa(){this.ka=null}_o(){return this.ya[0]||null}Ua(){return this.Fa()?this.us.scaleMargins.bottom*this.Zt()+this.ga:this.us.scaleMargins.top*this.Zt()+this.wa}qa(){return this.Fa()?this.us.scaleMargins.top*this.Zt()+this.wa:this.us.scaleMargins.bottom*this.Zt()+this.ga}Ya(){this.va.ma||(this.va.ma=!0,this.do())}Ba(){this.fa=null}Ea(t,i){if(this.Ya(),this.Fi())return 0;t=this.ca()&&t?Ii(t,this.Da):t;const s=l(this.wh()),n=this.qa()+(this.Ha()-1)*(t-s.ah())/s._h();return this.Xa(n)}La(t,i){if(this.Ya(),this.Fi())return 0;const s=this.Xa(t),n=l(this.wh()),e=n.ah()+n._h()*((s-this.qa())/(this.Ha()-1));return this.ca()?Bi(e,this.Da):e}za(){this.Ca=null,this.Oa.aa()}do(){const t=this.va.ba;if(null===t)return;let i=null;const s=this.uo();let n=0,e=0;for(const r of s){if(!r.Ct())continue;const s=r.xt();if(null===s)continue;const h=r.Pl(t.gn(),t.Mn());let a=h&&h.wh();if(null!==a){switch(this.us.mode){case 1:a=Vi(a,this.Da);break;case 2:a=Oi(a,s.Rt);break;case 3:a=Ei(a,s.Rt)}if(i=null===i?a:i.tn(l(a)),null!==h){const t=h.gh();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.wa&&e===this.ga||(this.wa=n,this.ga=e,this.Ca=null,this.Ba()),null!==i){if(i.ah()===i.oh()){const t=this._o(),s=5*(null===t||this.ih()||this.Na()?1:t.Al());this.ca()&&(i=Ni(i,this.Da)),i=new di(i.ah()-s,i.oh()+s),this.ca()&&(i=Vi(i,this.Da))}if(this.ca()){const t=Ni(i,this.Da),s=Fi(t);if(r=s,h=this.Da,r.Jl!==h.Jl||r.Ql!==h.Ql){const n=null!==this.pa?Ni(this.pa,this.Da):null;this.Da=s,i=Vi(t,s),null!==n&&(this.pa=Vi(n,s))}}this.Wa(i)}else null===this.mh&&(this.Wa(new di(-.5,.5)),this.Da=Fi(null));var r,h;this.va.ma=!0}Za(){return this.ih()?Ai:this.Na()?Li:this.ca()?t=>Ii(t,this.Da):null}yh(t,i){return void 0===this.Aa.priceFormatter?(void 0===i&&(i=this.Ol()),i.format(t)):this.Aa.priceFormatter(t)}}class Yi{constructor(t,i){this.ya=[],this.fo=new Map,this.da=0,this.qe=0,this.po=1e3,this.ka=null,this.vo=new b,this.mo=t,this.$i=i,this.bo=new Pi(this);const s=i.F();this.wo=this.Mo("left",s.leftPriceScale),this.So=this.Mo("right",s.rightPriceScale),this.wo.ja().l(this.yo.bind(this,this.wo),this),this.So.ja().l(this.yo.bind(this,this.So),this),this.ko(s)}ko(t){if(t.leftPriceScale&&this.wo.xh(t.leftPriceScale),t.rightPriceScale&&this.So.xh(t.rightPriceScale),t.localization&&(this.wo.Nl(),this.So.Nl()),t.overlayPriceScales){const i=Array.from(this.fo.values());for(const s of i){const i=l(s[0].Pt());i.xh(t.overlayPriceScales),t.localization&&i.Nl()}}}Co(t){switch(t){case"left":return this.wo;case"right":return this.So}return this.fo.has(t)?h(this.fo.get(t))[0].Pt():null}M(){this.Ut().xo().v(this),this.wo.ja().v(this),this.So.ja().v(this),this.ya.forEach((t=>{t.M&&t.M()})),this.vo.m()}To(){return this.po}Do(t){this.po=t}Ut(){return this.$i}Xt(){return this.qe}Zt(){return this.da}Po(t){this.qe=t,this.Ro()}$a(t){this.da=t,this.wo.$a(t),this.So.$a(t),this.ya.forEach((i=>{if(this.Je(i)){const s=i.Pt();null!==s&&s.$a(t)}})),this.Ro()}zl(){return this.ya}Je(t){const i=t.Pt();return null===i||this.wo!==i&&this.So!==i}Ja(t,i,s){const n=void 0!==s?s:this.Oo().Ao+1;this.Lo(t,i,n)}io(t){const i=this.ya.indexOf(t);r(-1!==i,"removeDataSource: invalid data source"),this.ya.splice(i,1);const s=l(t.Pt()).Vl();if(this.fo.has(s)){const i=h(this.fo.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.fo.delete(s))}const n=t.Pt();n&&n.zl().indexOf(t)>=0&&n.io(t),null!==n&&(n.Qa(),this.Eo(n)),this.ka=null}tr(t){return t===this.wo?"left":t===this.So?"right":"overlay"}Io(){return this.wo}Bo(){return this.So}Vo(t,i){t.eo(i)}No(t,i){t.ro(i),this.Ro()}Fo(t){t.ho()}Wo(t,i){t.lo(i)}zo(t,i){t.ao(i),this.Ro()}jo(t){t.oo()}Ro(){this.ya.forEach((t=>{t.As()}))}fs(){let t=null;return this.$i.F().rightPriceScale.visible&&0!==this.So.zl().length?t=this.So:this.$i.F().leftPriceScale.visible&&0!==this.wo.zl().length?t=this.wo:0!==this.ya.length&&(t=this.ya[0].Pt()),null===t&&(t=this.So),t}Qe(){let t=null;return this.$i.F().rightPriceScale.visible?t=this.So:this.$i.F().leftPriceScale.visible&&(t=this.wo),t}Eo(t){null!==t&&t.Va()&&this.$o(t)}Ho(t){const i=this.mo.Nn();t.Ia({zs:!0}),null!==i&&t.co(i),this.Ro()}Uo(){this.$o(this.wo),this.$o(this.So)}qo(){this.Eo(this.wo),this.Eo(this.So),this.ya.forEach((t=>{this.Je(t)&&this.Eo(t.Pt())})),this.Ro(),this.$i.Th()}Ga(){return null===this.ka&&(this.ka=ji(this.ya)),this.ka}Yo(){return this.vo}Xo(){return this.bo}$o(t){const i=t.uo();if(i&&i.length>0&&!this.mo.Fi()){const i=this.mo.Nn();null!==i&&t.co(i)}t.As()}Oo(){const t=this.Ga();if(0===t.length)return{Zo:0,Ao:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Zo:i,Ao:s}}Lo(t,i,s){let n=this.Co(i);if(null===n&&(n=this.Mo(i,this.$i.F().overlayPriceScales)),this.ya.push(t),!tt(i)){const s=this.fo.get(i)||[];s.push(t),this.fo.set(i,s)}n.Ja(t),t.Ki(n),t.Zi(s),this.Eo(n),this.ka=null}yo(t,i,s){i.rr!==s.rr&&this.$o(t)}Mo(t,i){const s=Object.assign({visible:!0,autoScale:!0},k(i)),n=new qi(t,s,this.$i.F().layout,this.$i.F().localization);return n.$a(this.Zt()),n}}const Xi=t=>t.getUTCFullYear();function Zi(t,i,s){return i.replace(/yyyy/g,(t=>nt(Xi(t),4))(t)).replace(/yy/g,(t=>nt(Xi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>nt((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>nt((t=>t.getUTCDate())(t),2))(t))}class Ki{constructor(t="yyyy-MM-dd",i="default"){this.Ko=t,this.Go=i}Jo(t){return Zi(t,this.Ko,this.Go)}}class Gi{constructor(t){this.Qo=t||"%h:%m:%s"}Jo(t){return this.Qo.replace("%h",nt(t.getUTCHours(),2)).replace("%m",nt(t.getUTCMinutes(),2)).replace("%s",nt(t.getUTCSeconds(),2))}}const Ji={t_:"yyyy-MM-dd",i_:"%h:%m:%s",s_:" ",n_:"default"};class Qi{constructor(t={}){const i=Object.assign(Object.assign({},Ji),t);this.e_=new Ki(i.t_,i.n_),this.r_=new Gi(i.i_),this.h_=i.s_}Jo(t){return`${this.e_.Jo(t)}${this.h_}${this.r_.Jo(t)}`}}class ts{constructor(t,i=50){this.Ee=0,this.Ie=1,this.Be=1,this.Ne=new Map,this.Ve=new Map,this.l_=t,this.Fe=i}Jo(t){const i=t.ot,s=void 0===i.a_?new Date(1e3*i.o_).getTime():new Date(Date.UTC(i.a_.year,i.a_.month-1,i.a_.day)).getTime(),n=this.Ne.get(s);if(void 0!==n)return n.__;if(this.Ee===this.Fe){const t=this.Ve.get(this.Be);this.Ve.delete(this.Be),this.Ne.delete(h(t)),this.Be++,this.Ee--}const e=this.l_(t);return this.Ne.set(s,{__:e,$e:this.Ie}),this.Ve.set(this.Ie,s),this.Ee++,this.Ie++,e}}class is{constructor(t,i){r(t<=i,"right should be >= left"),this.u_=t,this.c_=i}gn(){return this.u_}Mn(){return this.c_}d_(){return this.c_-this.u_+1}Lr(t){return this.u_<=t&&t<=this.c_}hh(t){return this.u_===t.gn()&&this.c_===t.Mn()}}function ss(t,i){return null===t||null===i?t===i:t.hh(i)}class ns{constructor(){this.f_=new Map,this.Ne=null}p_(t,i){this.v_(i),this.Ne=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.f_.get(i.m_);void 0===n&&(n=[],this.f_.set(i.m_,n)),n.push({Yn:s,ot:i.ot,b_:i.m_,w_:i.w_})}}g_(t,i){const s=Math.ceil(i/t);return null!==this.Ne&&this.Ne.M_===s||(this.Ne={Gl:this.S_(s),M_:s}),this.Ne.Gl}v_(t){if(0===t)return void this.f_.clear();const i=[];this.f_.forEach(((s,n)=>{t<=s[0].Yn?i.push(n):s.splice(bt(s,t,(i=>i.Yn<t)),1/0)}));for(const t of i)this.f_.delete(t)}S_(t){let i=[];for(const s of Array.from(this.f_.keys()).sort(((t,i)=>i-t))){if(!this.f_.get(s))continue;const n=i;i=[];const e=n.length;let r=0;const l=h(this.f_.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.Yn;for(;r<e;){const t=n[r],s=t.Yn;if(!(s<a)){o=s;break}r++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(h),_=a)}for(;r<e;r++)i.push(n[r])}return i}}class es{constructor(t){this.y_=t}k_(){return null===this.y_?null:new is(Math.floor(this.y_.gn()),Math.ceil(this.y_.Mn()))}C_(){return this.y_}static x_(){return new es(null)}}var rs,hs,ls,as,os;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(rs||(rs={}));class _s{constructor(t,i,s){this.qe=0,this.T_=null,this.D_=[],this.Ta=null,this.xa=null,this.P_=new ns,this.R_=new Map,this.A_=es.x_(),this.O_=!0,this.L_=new b,this.E_=new b,this.I_=new b,this.B_=null,this.V_=null,this.N_=[],this.us=i,this.Aa=s,this.F_=i.rightOffset,this.W_=i.barSpacing,this.$i=t,this.z_()}F(){return this.us}j_(t){w(this.Aa,t),this.H_(),this.z_()}xh(t,i){var s;w(this.us,t),this.us.fixLeftEdge&&this.U_(),this.us.fixRightEdge&&this.q_(),void 0!==t.barSpacing&&this.$i.Gs(t.barSpacing),void 0!==t.rightOffset&&this.$i.Js(t.rightOffset),void 0!==t.minBarSpacing&&this.$i.Gs(null!==(s=t.barSpacing)&&void 0!==s?s:this.W_),this.H_(),this.z_(),this.I_.m()}vs(t){var i,s;return null!==(s=null===(i=this.D_[t])||void 0===i?void 0:i.ot)&&void 0!==s?s:null}Hi(t){var i;return null!==(i=this.D_[t])&&void 0!==i?i:null}Fl(t,i){if(this.D_.length<1)return null;if(t.o_>this.D_[this.D_.length-1].ot.o_)return i?this.D_.length-1:null;const s=bt(this.D_,t.o_,((t,i)=>t.ot.o_<i));return t.o_<this.D_[s].ot.o_?i?s:null:s}Fi(){return 0===this.qe||0===this.D_.length||null===this.T_}Nn(){return this.Y_(),this.A_.k_()}X_(){return this.Y_(),this.A_.C_()}Z_(){const t=this.Nn();if(null===t)return null;const i={from:t.gn(),to:t.Mn()};return this.K_(i)}K_(t){const i=Math.round(t.from),s=Math.round(t.to),n=l(this.G_()),e=l(this.J_());return{from:l(this.vs(Math.max(n,i))),to:l(this.vs(Math.min(e,s)))}}Q_(t){return{from:l(this.Fl(t.from,!0)),to:l(this.Fl(t.to,!0))}}Xt(){return this.qe}Po(t){if(!isFinite(t)||t<=0)return;if(this.qe===t)return;const i=this.X_(),s=this.qe;if(this.qe=t,this.O_=!0,this.us.lockVisibleTimeRangeOnResize&&0!==s){const i=this.W_*t/s;this.W_=i}if(this.us.fixLeftEdge&&null!==i&&i.gn()<=0){const i=s-t;this.F_-=Math.round(i/this.W_)+1,this.O_=!0}this.tu(),this.iu()}Lt(t){if(this.Fi()||!M(t))return 0;const i=this.su()+this.F_-t;return this.qe-(i+.5)*this.W_-1}jn(t,i){const s=this.su(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ot,e=s+this.F_-n,r=this.qe-(e+.5)*this.W_-1;t[i].nt=r}}nu(t){return Math.ceil(this.eu(t))}Js(t){this.O_=!0,this.F_=t,this.iu(),this.$i.ru(),this.$i.Th()}Kn(){return this.W_}Gs(t){this.hu(t),this.iu(),this.$i.ru(),this.$i.Th()}lu(){return this.F_}Gl(){if(this.Fi())return null;if(null!==this.V_)return this.V_;const t=this.W_,i=5*(this.$i.F().layout.fontSize+4),s=Math.round(i/t),n=l(this.Nn()),e=Math.max(n.gn(),n.gn()-s),r=Math.max(n.Mn(),n.Mn()-s),h=this.P_.g_(t,i),a=this.G_()+s,o=this.J_()-s,_=this.au(),u=this.us.fixLeftEdge||_,c=this.us.fixRightEdge||_;let d=0;for(const t of h){if(!(e<=t.Yn&&t.Yn<=r))continue;let s;d<this.N_.length?(s=this.N_[d],s.ql=this.Lt(t.Yn),s._a=this.ou(t),s.b_=t.b_):(s={_u:!1,ql:this.Lt(t.Yn),_a:this.ou(t),b_:t.b_},this.N_.push(s)),this.W_>i/2&&!_?s._u=!1:s._u=u&&t.Yn<=a||c&&t.Yn>=o,d++}return this.N_.length=d,this.V_=this.N_,this.N_}uu(){this.O_=!0,this.Gs(this.us.barSpacing),this.Js(this.us.rightOffset)}cu(t){this.O_=!0,this.T_=t,this.iu(),this.U_()}du(t,i){const s=this.eu(t),n=this.Kn(),e=n+i*(n/10);this.Gs(e),this.us.rightBarStaysOnScroll||this.Js(this.lu()+(s-this.eu(t)))}eo(t){this.Ta&&this.oo(),null===this.xa&&null===this.B_&&(this.Fi()||(this.xa=t,this.fu()))}ro(t){if(null===this.B_)return;const i=Pt(this.qe-t,0,this.qe),s=Pt(this.qe-l(this.xa),0,this.qe);0!==i&&0!==s&&this.Gs(this.B_.Kn*i/s)}ho(){null!==this.xa&&(this.xa=null,this.pu())}lo(t){null===this.Ta&&null===this.B_&&(this.Fi()||(this.Ta=t,this.fu()))}ao(t){if(null===this.Ta)return;const i=(this.Ta-t)/this.Kn();this.F_=l(this.B_).lu+i,this.O_=!0,this.iu()}oo(){null!==this.Ta&&(this.Ta=null,this.pu())}vu(){this.mu(this.us.rightOffset)}mu(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.F_,n=performance.now();this.$i.Xs({bu:t=>(t-n)/i>=1,wu:e=>{const r=(e-n)/i;return r>=1?t:s+(t-s)*r}})}bt(t,i){this.O_=!0,this.D_=t,this.P_.p_(t,i),this.iu()}gu(){return this.L_}Mu(){return this.E_}Su(){return this.I_}su(){return this.T_||0}yu(t){const i=t.d_();this.hu(this.qe/i),this.F_=t.Mn()-this.su(),this.iu(),this.O_=!0,this.$i.ru(),this.$i.Th()}ku(){const t=this.G_(),i=this.J_();null!==t&&null!==i&&this.yu(new is(t,i+this.us.rightOffset))}Cu(t){const i=new is(t.from,t.to);this.yu(i)}Ui(t){return void 0!==this.Aa.timeFormatter?this.Aa.timeFormatter(t.w_):this.xu.Jo(new Date(1e3*t.ot.o_))}au(){const{handleScroll:t,handleScale:i}=this.$i.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}G_(){return 0===this.D_.length?null:0}J_(){return 0===this.D_.length?null:this.D_.length-1}Tu(t){return(this.qe-1-t)/this.W_}eu(t){const i=this.Tu(t),s=this.su()+this.F_-i;return Math.round(1e6*s)/1e6}hu(t){const i=this.W_;this.W_=t,this.tu(),i!==this.W_&&(this.O_=!0,this.Du())}Y_(){if(!this.O_)return;if(this.O_=!1,this.Fi())return void this.Pu(es.x_());const t=this.su(),i=this.qe/this.W_,s=this.F_+t,n=new is(s-i+1,s);this.Pu(new es(n))}tu(){const t=this.Ru();if(this.W_<t&&(this.W_=t,this.O_=!0),0!==this.qe){const t=.5*this.qe;this.W_>t&&(this.W_=t,this.O_=!0)}}Ru(){return this.us.fixLeftEdge&&this.us.fixRightEdge&&0!==this.D_.length?this.qe/this.D_.length:this.us.minBarSpacing}iu(){const t=this.Au();this.F_>t&&(this.F_=t,this.O_=!0);const i=this.Ou();null!==i&&this.F_<i&&(this.F_=i,this.O_=!0)}Ou(){const t=this.G_(),i=this.T_;if(null===t||null===i)return null;return t-i-1+(this.us.fixLeftEdge?this.qe/this.W_:Math.min(2,this.D_.length))}Au(){return this.us.fixRightEdge?0:this.qe/this.W_-Math.min(2,this.D_.length)}fu(){this.B_={Kn:this.Kn(),lu:this.lu()}}pu(){this.B_=null}ou(t){let i=this.R_.get(t.b_);return void 0===i&&(i=new ts((t=>this.Lu(t))),this.R_.set(t.b_,i)),i.Jo(t)}Lu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.b_,this.us.timeVisible,this.us.secondsVisible);return void 0!==this.us.tickMarkFormatter?this.us.tickMarkFormatter(t.w_,i,this.Aa.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.a_?new Date(1e3*t.o_):new Date(Date.UTC(t.a_.year,t.a_.month-1,t.a_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.ot,i,this.Aa.locale)}Pu(t){const i=this.A_;this.A_=t,ss(i.k_(),this.A_.k_())||this.L_.m(),ss(i.C_(),this.A_.C_())||this.E_.m(),this.Du()}Du(){this.V_=null}H_(){this.Du(),this.R_.clear()}z_(){const t=this.Aa.dateFormat;this.us.timeVisible?this.xu=new Qi({t_:t,i_:this.us.secondsVisible?"%h:%m:%s":"%h:%m",s_:"   ",n_:this.Aa.locale}):this.xu=new Ki(t,this.Aa.locale)}U_(){if(!this.us.fixLeftEdge)return;const t=this.G_();if(null===t)return;const i=this.Nn();if(null===i)return;const s=i.gn()-t;if(s<0){const t=this.F_-s-1;this.Js(t)}this.tu()}q_(){this.iu(),this.tu()}}class us extends A{constructor(t){super(),this.Eu=new Map,this.Et=t}Z(t){}G(t){if(!this.Et.Ct)return;t.save();let i=0;for(const s of this.Et.Iu){if(0===s.ti.length)continue;t.font=s.D;const n=this.Bu(t,s.ti);n>this.Et.Xt?s.du=this.Et.Xt/n:s.du=1,i+=s.Vu*s.du}let s=0;switch(this.Et.Nu){case"top":s=0;break;case"center":s=Math.max((this.Et.Zt-i)/2,0);break;case"bottom":s=Math.max(this.Et.Zt-i,0)}t.fillStyle=this.Et.R;for(const i of this.Et.Iu){t.save();let n=0;switch(this.Et.Fu){case"left":t.textAlign="left",n=i.Vu/2;break;case"center":t.textAlign="center",n=this.Et.Xt/2;break;case"right":t.textAlign="right",n=this.Et.Xt-1-i.Vu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.du,i.du),t.fillText(i.ti,0,i.Wu),t.restore(),s+=i.Vu*i.du}t.restore()}Bu(t,i){const s=this.zu(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}zu(t){let i=this.Eu.get(t);return void 0===i&&(i=new Map,this.Eu.set(t,i)),i}}class cs{constructor(t){this.ft=!0,this.zt={Ct:!1,R:"",Zt:0,Xt:0,Iu:[],Nu:"center",Fu:"center"},this.jt=new us(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(t,i),this.ft=!1),this.jt}Mt(t,i){const s=this.$t.F(),n=this.zt;n.Ct=s.visible,n.Ct&&(n.R=s.color,n.Xt=i,n.Zt=t,n.Fu=s.horzAlign,n.Nu=s.vertAlign,n.Iu=[{ti:s.text,D:D(s.fontSize,s.fontFamily,s.fontStyle),Vu:1.2*s.fontSize,Wu:0,du:0}])}}class ds extends G{constructor(t,i){super(),this.us=i,this.ws=new cs(this)}Ps(){return[]}Ds(){return[this.ws]}F(){return this.us}As(){this.ws.bt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(hs||(hs={}));class fs{constructor(t,i){this.ju=[],this.$u=[],this.qe=0,this.Hu=null,this.Uu=new b,this.qu=new b,this.Yu=null,this.Xu=t,this.us=i,this.Zu=new P(this),this.mo=new _s(this,i.timeScale,this.us.localization),this.vt=new Q(this,i.crosshair),this.Ku=new xi(i.crosshair),this.Gu=new ds(this,i.watermark),this.Ju(),this.ju[0].Do(2e3),this.Qu=this.tc(0),this.ic=this.tc(1)}fl(){this.sc(it.en())}Th(){this.sc(it.nn())}Tl(){this.sc(new it(1))}pl(t){const i=this.nc(t);this.sc(i)}ec(){return this.Hu}rc(t){const i=this.Hu;this.Hu=t,null!==i&&this.pl(i.hc),null!==t&&this.pl(t.hc)}F(){return this.us}xh(t){w(this.us,t),this.ju.forEach((i=>i.ko(t))),void 0!==t.timeScale&&this.mo.xh(t.timeScale),void 0!==t.localization&&this.mo.j_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Uu.m(),this.Qu=this.tc(0),this.ic=this.tc(1),this.fl()}lc(t,i){if("left"===t)return void this.xh({leftPriceScale:i});if("right"===t)return void this.xh({rightPriceScale:i});const s=this.ac(t);null!==s&&(s.Pt.xh(i),this.Uu.m())}ac(t){for(const i of this.ju){const s=i.Co(t);if(null!==s)return{Ht:i,Pt:s}}return null}yt(){return this.mo}oc(){return this.ju}_c(){return this.Gu}uc(){return this.vt}cc(){return this.qu}dc(t,i){t.$a(i),this.ru()}Po(t){this.qe=t,this.mo.Po(this.qe),this.ju.forEach((i=>i.Po(t))),this.ru()}Ju(t){const i=new Yi(this.mo,this);void 0!==t?this.ju.splice(t,0,i):this.ju.push(i);const s=void 0===t?this.ju.length-1:t,n=it.en();return n.Fs(s,{Ws:0,zs:!0}),this.sc(n),i}Vo(t,i,s){t.Vo(i,s)}No(t,i,s){t.No(i,s),this.vl(),this.sc(this.fc(t,2))}Fo(t,i){t.Fo(i),this.sc(this.fc(t,2))}Wo(t,i,s){i.Va()||t.Wo(i,s)}zo(t,i,s){i.Va()||(t.zo(i,s),this.vl(),this.sc(this.fc(t,2)))}jo(t,i){i.Va()||(t.jo(i),this.sc(this.fc(t,2)))}Ho(t,i){t.Ho(i),this.sc(this.fc(t,2))}vc(t){this.mo.eo(t)}mc(t,i){const s=this.yt();if(s.Fi()||0===i)return;const n=s.Xt();t=Math.max(1,Math.min(t,n)),s.du(t,i),this.ru()}bc(t){this.wc(0),this.gc(t),this.Mc()}Sc(t){this.mo.ro(t),this.ru()}yc(){this.mo.ho(),this.Th()}wc(t){this.mo.lo(t)}gc(t){this.mo.ao(t),this.ru()}Mc(){this.mo.oo(),this.Th()}wt(){return this.$u}kc(t,i,s){this.vt.gs(t,i);let n=NaN,e=this.mo.nu(t);const r=this.mo.Nn();null!==r&&(e=Math.min(Math.max(r.gn(),e),r.Mn()));const h=s.fs(),l=h.xt();null!==l&&(n=h.ps(i,l)),n=this.Ku.Wl(n,e,s),this.vt.ks(e,n,s),this.Tl(),this.qu.m(this.vt.St(),{x:t,y:i})}Cc(){this.uc().xs(),this.Tl(),this.qu.m(null,null)}vl(){const t=this.vt.Ht();if(null!==t){const i=this.vt.Ss(),s=this.vt.ys();this.kc(i,s,t)}this.vt.As()}xc(t,i,s){const n=this.mo.vs(0);void 0!==i&&void 0!==s&&this.mo.bt(i,s);const e=this.mo.vs(0),r=this.mo.su(),h=this.mo.Nn();if(null!==h&&null!==n&&null!==e){const i=h.Lr(r),s=n.o_>e.o_,l=null!==t&&t>r&&!s,a=i&&this.mo.F().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.mo.Js(this.mo.lu()-i)}}this.mo.cu(t)}wl(t){null!==t&&t.qo()}Ge(t){const i=this.ju.find((i=>i.Ga().includes(t)));return void 0===i?null:i}ru(){this.Gu.As(),this.ju.forEach((t=>t.qo())),this.vl()}M(){this.ju.forEach((t=>t.M())),this.ju.length=0,this.us.localization.priceFormatter=void 0,this.us.localization.timeFormatter=void 0}Tc(){return this.Zu}ir(){return this.Zu.F()}xo(){return this.Uu}Dc(t,i){const s=this.ju[0],n=this.Pc(i,t,s);return this.$u.push(n),1===this.$u.length?this.fl():this.Th(),n}Rc(t){const i=this.Ge(t),s=this.$u.indexOf(t);r(-1!==s,"Series not found"),this.$u.splice(s,1),l(i).io(t),t.M&&t.M()}dl(t,i){const s=l(this.Ge(t));s.io(t);const n=this.ac(i);if(null===n){const n=t.Xi();s.Ja(t,i,n)}else{const e=n.Ht===s?t.Xi():void 0;n.Ht.Ja(t,i,e)}}ku(){const t=it.nn();t.Hs(),this.sc(t)}Ac(t){const i=it.nn();i.Ys(t),this.sc(i)}Ks(){const t=it.nn();t.Ks(),this.sc(t)}Gs(t){const i=it.nn();i.Gs(t),this.sc(i)}Js(t){const i=it.nn();i.Js(t),this.sc(i)}Xs(t){const i=it.nn();i.Xs(t),this.sc(i)}Us(){const t=it.nn();t.Us(),this.sc(t)}Oc(){return this.us.rightPriceScale.visible?"right":"left"}Lc(){return this.ic}U(){return this.Qu}Ot(t){const i=this.ic,s=this.Qu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Yu||this.Yu.vn!==s||this.Yu.mn!==i)this.Yu={vn:s,mn:i,Ec:new Map};else{const i=this.Yu.Ec.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=v(t),[l,a,o,c]=v(i),d=[_(n+s*(l-n)),_(e+s*(a-e)),_(r+s*(o-r)),u(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.Yu.Ec.set(t,n),n}fc(t,i){const s=new it(i);if(null!==t){const n=this.ju.indexOf(t);s.Fs(n,{Ws:i})}return s}nc(t,i){return void 0===i&&(i=2),this.fc(this.Ge(t),i)}sc(t){this.Xu&&this.Xu(t),this.ju.forEach((t=>t.Xo().Dh().bt()))}Pc(t,i,s){const n=new Ci(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Oc();return s.Ja(n,e),tt(e)||n.xh(t),n}tc(t){const i=this.us.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ps(t){return!g(t)&&!S(t)}function vs(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(ls||(ls={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(as||(as={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(os||(os={}));class ms{constructor(t,i){this.Vt=t,this.Nt=i}hh(t){return this.Vt===t.Vt&&this.Nt===t.Nt}}function bs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ws(t){const i=l(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function gs(i,s){const n=l(i.ownerDocument).createElement("canvas");i.appendChild(n);const e=t(n,{allowDownsampling:!1});return e.resizeCanvas({width:s.Vt,height:s.Nt}),e}function Ms(t,i){return t.Ic-i.Ic}function Ss(t,i,s){const n=(t.Ic-i.Ic)/(t.ot-i.ot);return Math.sign(n)*Math.min(Math.abs(n),s)}class ys{constructor(t,i,s,n){this.Bc=null,this.Vc=null,this.Nc=null,this.Fc=null,this.Wc=null,this.zc=0,this.jc=0,this.$c=t,this.Hc=i,this.Uc=s,this.rn=n}qc(t,i){if(null!==this.Bc){if(this.Bc.ot===i)return void(this.Bc.Ic=t);if(Math.abs(this.Bc.Ic-t)<this.rn)return}this.Fc=this.Nc,this.Nc=this.Vc,this.Vc=this.Bc,this.Bc={ot:i,Ic:t}}cr(t,i){if(null===this.Bc||null===this.Vc)return;if(i-this.Bc.ot>50)return;let s=0;const n=Ss(this.Bc,this.Vc,this.Hc),e=Ms(this.Bc,this.Vc),r=[n],h=[e];if(s+=e,null!==this.Nc){const t=Ss(this.Vc,this.Nc,this.Hc);if(Math.sign(t)===Math.sign(n)){const i=Ms(this.Vc,this.Nc);if(r.push(t),h.push(i),s+=i,null!==this.Fc){const t=Ss(this.Nc,this.Fc,this.Hc);if(Math.sign(t)===Math.sign(n)){const i=Ms(this.Nc,this.Fc);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.$c||(this.Wc={Ic:t,ot:i},this.jc=l,this.zc=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.Uc))}wu(t){const i=l(this.Wc),s=t-i.ot;return i.Ic+this.jc*(Math.pow(this.Uc,s)-1)/Math.log(this.Uc)}bu(t){return null===this.Wc||this.Yc(t)===this.zc}Yc(t){const i=t-l(this.Wc).ot;return Math.min(i,this.zc)}}const ks="undefined"!=typeof window;function Cs(){return!!ks&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function xs(){return!!ks&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ts(t){ks&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Ds{constructor(t,i,s){this.Xc=0,this.Zc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Gc=0,this.Jc=null,this.Qc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.td=null,this.sd=!1,this.nd=null,this.ed=null,this.rd=!1,this.hd=!1,this.ld=!1,this.ad=null,this.od=null,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=0,this.md=!1,this.bd=!1,this.wd=!1,this.gd=0,this.Md=null,this.Sd=!xs(),this.yd=t=>{this.kd(t)},this.Cd=t=>{if(this.xd(t)){const i=this.Td(t);if(++this.Gc,this.Jc&&this.Gc>1){const{Dd:s}=this.Pd(As(t),this.Qc);s<30&&!this.ld&&this.Rd(i,this.Od.Ad),this.Ld()}}else{const i=this.Td(t);if(++this.Xc,this.Zc&&this.Xc>1){const{Dd:s}=this.Pd(As(t),this.Kc);s<5&&!this.hd&&this.Ed(i,this.Od.Id),this.Bd()}}},this.Vd=t,this.Od=i,this.us=s,this.Nd()}M(){null!==this.ad&&(this.ad(),this.ad=null),null!==this.od&&(this.od(),this.od=null),null!==this.ud&&(this.ud(),this.ud=null),null!==this.dd&&(this.dd(),this.dd=null),null!==this.fd&&(this.fd(),this.fd=null),null!==this._d&&(this._d(),this._d=null),this.Fd(),this.Bd()}Wd(t){this.ud&&this.ud();const i=this.zd.bind(this);if(this.ud=()=>{this.Vd.removeEventListener("mousemove",i)},this.Vd.addEventListener("mousemove",i),this.xd(t))return;const s=this.Td(t);this.Ed(s,this.Od.jd),this.Sd=!0}Bd(){null!==this.Zc&&clearTimeout(this.Zc),this.Xc=0,this.Zc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ld(){null!==this.Jc&&clearTimeout(this.Jc),this.Gc=0,this.Jc=null,this.Qc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}zd(t){if(this.wd||null!==this.ed)return;if(this.xd(t))return;const i=this.Td(t);this.Ed(i,this.Od.$d),this.Sd=!0}Hd(t){const i=Ls(t.changedTouches,l(this.Md));if(null===i)return;if(this.gd=Os(t),null!==this.pd)return;if(this.bd)return;this.md=!0;const s=this.Pd(As(i),l(this.ed)),{Ud:n,qd:e,Dd:r}=s;if(this.rd||!(r<5)){if(!this.rd){const t=.5*n,i=e>=t&&!this.us.Yd(),s=t>e&&!this.us.Xd();i||s||(this.bd=!0),this.rd=!0,this.ld=!0,this.Fd(),this.Ld()}if(!this.bd){const s=this.Td(t,i);this.Rd(s,this.Od.Zd),Rs(t)}}}Kd(t){if(0!==t.button)return;const i=this.Pd(As(t),l(this.nd)),{Dd:s}=i;if(s>=5&&(this.hd=!0,this.Bd()),this.hd){const i=this.Td(t);this.Ed(i,this.Od.Gd)}}Pd(t,i){const s=Math.abs(i.nt-t.nt),n=Math.abs(i.et-t.et);return{Ud:s,qd:n,Dd:s+n}}Jd(t){let i=Ls(t.changedTouches,l(this.Md));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Md=null,this.gd=Os(t),this.Fd(),this.ed=null,this.fd&&(this.fd(),this.fd=null);const s=this.Td(t,i);if(this.Rd(s,this.Od.Qd),++this.Gc,this.Jc&&this.Gc>1){const{Dd:t}=this.Pd(As(i),this.Qc);t<30&&!this.ld&&this.Rd(s,this.Od.Ad),this.Ld()}else this.ld||(this.Rd(s,this.Od.tf),this.Od.tf&&Rs(t));0===this.Gc&&Rs(t),0===t.touches.length&&this.sd&&(this.sd=!1,Rs(t))}kd(t){if(0!==t.button)return;const i=this.Td(t);if(this.nd=null,this.wd=!1,this.dd&&(this.dd(),this.dd=null),Cs()){this.Vd.ownerDocument.documentElement.removeEventListener("mouseleave",this.yd)}if(!this.xd(t))if(this.Ed(i,this.Od.if),++this.Xc,this.Zc&&this.Xc>1){const{Dd:s}=this.Pd(As(t),this.Kc);s<5&&!this.hd&&this.Ed(i,this.Od.Id),this.Bd()}else this.hd||this.Ed(i,this.Od.sf)}Fd(){null!==this.td&&(clearTimeout(this.td),this.td=null)}nf(t){if(null!==this.Md)return;const i=t.changedTouches[0];this.Md=i.identifier,this.gd=Os(t);const s=this.Vd.ownerDocument.documentElement;this.ld=!1,this.rd=!1,this.bd=!1,this.ed=As(i),this.fd&&(this.fd(),this.fd=null);{const i=this.Hd.bind(this),n=this.Jd.bind(this);this.fd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.Fd(),this.td=setTimeout(this.ef.bind(this,t),240)}const n=this.Td(t,i);this.Rd(n,this.Od.rf),this.Jc||(this.Gc=0,this.Jc=setTimeout(this.Ld.bind(this),500),this.Qc=As(i))}hf(t){if(0!==t.button)return;const i=this.Vd.ownerDocument.documentElement;Cs()&&i.addEventListener("mouseleave",this.yd),this.hd=!1,this.nd=As(t),this.dd&&(this.dd(),this.dd=null);{const t=this.Kd.bind(this),s=this.kd.bind(this);this.dd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.wd=!0,this.xd(t))return;const s=this.Td(t);this.Ed(s,this.Od.lf),this.Zc||(this.Xc=0,this.Zc=setTimeout(this.Bd.bind(this),500),this.Kc=As(t))}Nd(){this.Vd.addEventListener("mouseenter",this.Wd.bind(this)),this.Vd.addEventListener("touchcancel",this.Fd.bind(this));{const t=this.Vd.ownerDocument,i=t=>{this.Od.af&&(t.composed&&this.Vd.contains(t.composedPath()[0])||t.target&&this.Vd.contains(t.target)||this.Od.af())};this.od=()=>{t.removeEventListener("touchstart",i)},this.ad=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}xs()&&(this._d=()=>{this.Vd.removeEventListener("dblclick",this.Cd)},this.Vd.addEventListener("dblclick",this.Cd)),this.Vd.addEventListener("mouseleave",this._f.bind(this)),this.Vd.addEventListener("touchstart",this.nf.bind(this),{passive:!0}),Ts(this.Vd),this.Vd.addEventListener("mousedown",this.hf.bind(this)),this.uf(),this.Vd.addEventListener("touchmove",(()=>{}),{passive:!1})}uf(){void 0===this.Od.cf&&void 0===this.Od.df&&void 0===this.Od.ff||(this.Vd.addEventListener("touchstart",(t=>this.pf(t.touches)),{passive:!0}),this.Vd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.pd&&void 0!==this.Od.df){const i=Ps(t.touches[0],t.touches[1])/this.vd;this.Od.df(this.pd,i),Rs(t)}}),{passive:!1}),this.Vd.addEventListener("touchend",(t=>{this.pf(t.touches)})))}pf(t){1===t.length&&(this.md=!1),2!==t.length||this.md||this.sd?this.vf():this.mf(t)}mf(t){const i=this.Vd.getBoundingClientRect()||{left:0,top:0};this.pd={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.vd=Ps(t[0],t[1]),void 0!==this.Od.cf&&this.Od.cf(),this.Fd()}vf(){null!==this.pd&&(this.pd=null,void 0!==this.Od.ff&&this.Od.ff())}_f(t){if(this.ud&&this.ud(),this.xd(t))return;if(!this.Sd)return;const i=this.Td(t);this.Ed(i,this.Od.bf),this.Sd=!xs()}ef(t){const i=Ls(t.touches,l(this.Md));if(null===i)return;const s=this.Td(t,i);this.Rd(s,this.Od.wf),this.ld=!0,this.sd=!0}xd(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Os(t)<this.gd+500}Rd(t,i){i&&i.call(this.Od,t)}Ed(t,i){i&&i.call(this.Od,t)}Td(t,i){const s=i||t,n=this.Vd.getBoundingClientRect()||{left:0,top:0};return{gf:s.clientX,Mf:s.clientY,Sf:s.pageX,yf:s.pageY,kf:s.screenX,Cf:s.screenY,xf:s.clientX-n.left,Tf:s.clientY-n.top,Df:t.ctrlKey,Pf:t.altKey,Rf:t.shiftKey,Af:t.metaKey,Of:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Lf:t.type,Ef:s.target,If:t.view,Bf:()=>{"touchstart"!==t.type&&Rs(t)}}}}function Ps(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Rs(t){t.cancelable&&t.preventDefault()}function As(t){return{nt:t.pageX,et:t.pageY}}function Os(t){return t.timeStamp||performance.now()}function Ls(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Es{constructor(t,i,s,n){this.Vi=null,this.Vf=null,this.Nf=!1,this.Ff=new jt(200),this.Ir=null,this.Wf=0,this.zf=!1,this.jf=()=>{this.zf||this.Qi.$f().Ut().Th()},this.Hf=()=>{this.zf||this.Qi.$f().Ut().Th()},this.Qi=t,this.us=i,this.Ra=i.layout,this.Zu=s,this.Uf="left"===n,this.qf=document.createElement("div"),this.qf.style.height="100%",this.qf.style.overflow="hidden",this.qf.style.width="25px",this.qf.style.left="0",this.qf.style.position="relative",this.Yf=gs(this.qf,new ms(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const e=this.Yf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Xf=gs(this.qf,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const r=this.Xf.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={lf:this.Zf.bind(this),rf:this.Zf.bind(this),Gd:this.Kf.bind(this),Zd:this.Kf.bind(this),af:this.Gf.bind(this),if:this.Jf.bind(this),Qd:this.Jf.bind(this),Id:this.Qf.bind(this),Ad:this.Qf.bind(this),jd:this.tp.bind(this),bf:this.ip.bind(this)};this.sp=new Ds(this.Xf.canvas,h,{Yd:()=>!1,Xd:()=>!0})}M(){this.sp.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy(),null!==this.Vi&&this.Vi.no().v(this),this.Vi=null}np(){return this.qf}T(){return this.Ra.fontSize}ep(){const t=this.Zu.F();return this.Ir!==t.D&&(this.Ff.We(),this.Ir=t.D),t}rp(){if(null===this.Vi)return 0;let t=0;const i=this.ep(),s=ws(this.Yf.canvas),n=this.Vi.Gl();s.font=this.hp(),n.length>0&&(t=Math.max(this.Ff.Mi(s,n[0]._a),this.Ff.Mi(s,n[n.length-1]._a)));const e=this.lp();for(let i=e.length;i--;){const n=this.Ff.Mi(s,e[i].ti());n>t&&(t=n)}const r=this.Vi.xt();if(null!==r&&null!==this.Vf){const i=this.Vi.ps(1,r),n=this.Vi.ps(this.Vf.Nt-2,r);t=Math.max(t,this.Ff.Mi(s,this.Vi.Wi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.Ff.Mi(s,this.Vi.Wi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.k+i.C+i.L+i.I+5+h);return l+=l%2,l}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.qf.style.width=t.Vt+"px",this.qf.style.height=t.Nt+"px",this.qf.style.minWidth=t.Vt+"px")}op(){return l(this.Vf).Vt}Ki(t){this.Vi!==t&&(null!==this.Vi&&this.Vi.no().v(this),this.Vi=t,t.no().l(this.Ma.bind(this),this))}Pt(){return this.Vi}We(){const t=this.Qi._p();this.Qi.$f().Ut().Ho(t,l(this.Pt()))}up(t){if(null===this.Vf)return;if(1!==t){const t=ws(this.Yf.canvas);this.cp(),this.dp(t,this.Yf.pixelRatio),this.ke(t,this.Yf.pixelRatio),this.fp(t,this.Yf.pixelRatio),this.pp(t,this.Yf.pixelRatio)}const i=ws(this.Xf.canvas),s=this.Vf.Vt,n=this.Vf.Nt;F(i,this.Xf.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.vp(i,this.Xf.pixelRatio)}mp(){return this.Yf.canvas}bt(){var t;null===(t=this.Vi)||void 0===t||t.Gl()}Zf(t){if(null===this.Vi||this.Vi.Fi()||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p();this.Nf=!0,i.Vo(s,this.Vi,t.Tf)}Kf(t){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p(),n=this.Vi;i.No(s,n,t.Tf)}Gf(){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const t=this.Qi.$f().Ut(),i=this.Qi._p(),s=this.Vi;this.Nf&&(this.Nf=!1,t.Fo(i,s))}Jf(t){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p();this.Nf=!1,i.Fo(s,this.Vi)}Qf(t){this.us.handleScale.axisDoubleClickReset.price&&this.We()}tp(t){if(null===this.Vi)return;!this.Qi.$f().Ut().F().handleScale.axisPressedMouseMove.price||this.Vi.ih()||this.Vi.Na()||this.bp(1)}ip(t){this.bp(0)}lp(){const t=[],i=null===this.Vi?void 0:this.Vi;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].Ps(this.Qi._p(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Qi._p().Ga()),t}dp(t,i){if(null===this.Vf)return;const s=this.Vf.Vt,n=this.Vf.Nt;F(t,i,(()=>{const i=this.Qi._p().Ut(),e=i.U(),r=i.Lc();e===r?W(t,0,0,s,n,e):H(t,0,0,s,n,e,r)}))}ke(t,i){if(null===this.Vf||null===this.Vi||!this.Vi.F().borderVisible)return;t.save(),t.fillStyle=this.Vi.F().borderColor;const s=Math.max(1,Math.floor(this.ep().k*i));let n;n=this.Uf?Math.floor(this.Vf.Vt*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.Vf.Nt*i)),t.restore()}fp(t,i){var s;if(null===this.Vf||null===this.Vi)return;const n=this.Vi.Gl();t.save();const e=this.Vi.F();t.strokeStyle=e.borderColor,t.font=this.hp(),t.fillStyle=e.borderColor;const r=this.ep(),h=this.Uf?Math.floor((this.Vf.Vt-r.C)*i):0,l=this.Uf?Math.round(h-r.L*i):Math.round(h+r.C*i+r.L*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(r.C*i);t.beginPath();for(const e of n)t.rect(h,Math.round(e.ql*i)-o,s,a);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.Ra.textColor,t.textAlign=this.Uf?"right":"left",t.textBaseline="middle";const _=n.map((i=>this.Ff.gi(t,i._a)));F(t,i,(()=>{for(let s=n.length;s--;){const e=n[s];t.fillText(e._a,l/i,e.ql+_[s])}})),t.restore()}cp(){if(null===this.Vf||null===this.Vi)return;let t=this.Vf.Nt/2;const i=[],s=this.Vi.Ga().slice(),n=this.Qi._p(),e=this.ep();this.Vi===n.Qe()&&this.Qi._p().Ga().forEach((t=>{n.Je(t)&&s.push(t)}));const r=this.Vi.zl()[0],h=this.Vi;s.forEach((s=>{const e=s.Ps(n,h);e.forEach((t=>{t.Oi(null),t.Li()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].yi())})),i.forEach((t=>t.Oi(t.yi())));this.Vi.F().alignLabels&&this.wp(i,e,t)}wp(t,i,s){if(null===this.Vf)return;const n=t.filter((t=>t.yi()<=s)),e=t.filter((t=>t.yi()>s));n.sort(((t,i)=>i.yi()-t.yi())),n.length&&e.length&&e.push(n[0]),e.sort(((t,i)=>t.yi()-i.yi()));for(const s of t){const t=Math.floor(s.Zt(i)/2),n=s.yi();n>-t&&n<t&&s.Oi(t),n>this.Vf.Nt-t&&n<this.Vf.Nt+t&&s.Oi(this.Vf.Nt-t)}for(let t=1;t<n.length;t++){const s=n[t],e=n[t-1],r=e.Zt(i,!1),h=s.yi(),l=e.Ai();h>l-r&&s.Oi(l-r)}for(let t=1;t<e.length;t++){const s=e[t],n=e[t-1],r=n.Zt(i,!0),h=s.yi(),l=n.Ai();h<l+r&&s.Oi(l+r)}}pp(t,i){if(null===this.Vf)return;t.save();const s=this.Vf,n=this.lp(),e=this.ep(),r=this.Uf?"right":"left";n.forEach((n=>{if(n.Ei()){const h=n.gt(l(this.Vi));t.save(),h.X(t,e,this.Ff,s.Vt,r,i),t.restore()}})),t.restore()}vp(t,i){if(null===this.Vf||null===this.Vi)return;t.save();const s=this.Vf,n=this.Qi.$f().Ut(),e=[],r=this.Qi._p(),h=n.uc().Ps(r,this.Vi);h.length&&e.push(h);const a=this.ep(),o=this.Uf?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.gt(l(this.Vi)).X(t,a,this.Ff,s.Vt,o,i),t.restore()}))})),t.restore()}bp(t){this.qf.style.cursor=1===t?"ns-resize":"default"}Ma(){const t=this.rp();this.Wf<t&&this.Qi.$f().Ut().fl(),this.Wf=t}hp(){return D(this.Ra.fontSize,this.Ra.fontFamily)}}function Is(t,i,s,n,e){t.K&&t.K(i,s,n,e)}function Bs(t,i,s,n,e){t.X(i,s,n,e)}function Vs(t,i){return t.Ds(i)}function Ns(t,i){return t.Gi(i)}function Fs(t,i){return void 0!==t.xl?t.xl(i):[]}class Ws{constructor(t,i){this.Vf=new ms(0,0),this.gp=null,this.Mp=null,this.Sp=null,this.yp=!1,this.kp=new b,this.Cp=0,this.xp=!1,this.Tp=null,this.Dp=!1,this.Pp=null,this.Rp=null,this.zf=!1,this.jf=()=>{this.zf||null===this.Ap||this.$i().Th()},this.Hf=()=>{this.zf||null===this.Ap||this.$i().Th()},this.Op=t,this.Ap=i,this.Ap.Yo().l(this.Lp.bind(this),this,!0),this.Ep=document.createElement("td"),this.Ep.style.padding="0",this.Ep.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Ip=document.createElement("td"),this.Ip.style.padding="0",this.Bp=document.createElement("td"),this.Bp.style.padding="0",this.Ep.appendChild(s),this.Yf=gs(s,new ms(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const n=this.Yf.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Xf=gs(s,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const e=this.Xf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Vp=document.createElement("tr"),this.Vp.appendChild(this.Ip),this.Vp.appendChild(this.Ep),this.Vp.appendChild(this.Bp),this.Np(),this.sp=new Ds(this.Xf.canvas,this,{Yd:()=>null===this.Tp&&!this.Op.F().handleScroll.vertTouchDrag,Xd:()=>null===this.Tp&&!this.Op.F().handleScroll.horzTouchDrag})}M(){null!==this.gp&&this.gp.M(),null!==this.Mp&&this.Mp.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy(),null!==this.Ap&&this.Ap.Yo().v(this),this.sp.M()}_p(){return l(this.Ap)}Fp(t){null!==this.Ap&&this.Ap.Yo().v(this),this.Ap=t,null!==this.Ap&&this.Ap.Yo().l(Ws.prototype.Lp.bind(this),this,!0),this.Np()}$f(){return this.Op}np(){return this.Vp}Np(){if(null!==this.Ap&&(this.Wp(),0!==this.$i().wt().length)){if(null!==this.gp){const t=this.Ap.Io();this.gp.Ki(l(t))}if(null!==this.Mp){const t=this.Ap.Bo();this.Mp.Ki(l(t))}}}zp(){null!==this.gp&&this.gp.bt(),null!==this.Mp&&this.Mp.bt()}To(){return null!==this.Ap?this.Ap.To():0}Do(t){this.Ap&&this.Ap.Do(t)}jd(t){if(!this.Ap)return;this.jp();const i=t.xf,s=t.Tf;this.$p(i,s)}lf(t){this.jp(),this.Hp(),this.$p(t.xf,t.Tf)}$d(t){if(!this.Ap)return;this.jp();const i=t.xf,s=t.Tf;this.$p(i,s);const n=this.Br(i,s);this.$i().rc(n&&{hc:n.hc,Up:n.Up})}sf(t){null!==this.Ap&&(this.jp(),this.qp(t))}Gd(t){this.jp(),this.Yp(t),this.$p(t.xf,t.Tf)}if(t){null!==this.Ap&&(this.jp(),this.xp=!1,this.Xp(t))}tf(t){null!==this.Ap&&this.qp(t)}wf(t){if(this.xp=!0,null===this.Tp){const i={x:t.xf,y:t.Tf};this.Zp(i,i)}}bf(t){null!==this.Ap&&(this.jp(),this.Ap.Ut().rc(null),this.Kp())}Gp(){return this.kp}cf(){this.Cp=1,this.$i().Us()}df(t,i){if(!this.Op.F().handleScale.pinch)return;const s=5*(i-this.Cp);this.Cp=i,this.$i().mc(t.nt,s)}rf(t){if(this.xp=!1,this.Dp=null!==this.Tp,this.Hp(),null!==this.Tp){const i=this.$i().uc();this.Pp={x:i.Kt(),y:i.Gt()},this.Tp={x:t.xf,y:t.Tf}}}Zd(t){if(null===this.Ap)return;const i=t.xf,s=t.Tf;if(null===this.Tp)this.Yp(t);else{this.Dp=!1;const t=l(this.Pp),n=t.x+(i-this.Tp.x),e=t.y+(s-this.Tp.y);this.$p(n,e)}}Qd(t){0===this.$f().F().trackingMode.exitMode&&(this.Dp=!0),this.Jp(),this.Xp(t)}Br(t,i){const s=this.Ap;if(null===s)return null;const n=s.Ga();for(const e of n){const n=this.Qp(e.Ds(s),t,i);if(null!==n)return{hc:e,If:n.If,Up:n.Up}}return null}tv(t,i){l("left"===i?this.gp:this.Mp).ap(new ms(t,this.Vf.Nt))}iv(){return this.Vf}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.Ep.style.width=t.Vt+"px",this.Ep.style.height=t.Nt+"px")}sv(){const t=l(this.Ap);t.Eo(t.Io()),t.Eo(t.Bo());for(const i of t.zl())if(t.Je(i)){const s=i.Pt();null!==s&&t.Eo(s),i.As()}}mp(){return this.Yf.canvas}up(t){if(0===t)return;if(null===this.Ap)return;if(t>1&&this.sv(),null!==this.gp&&this.gp.up(t),null!==this.Mp&&this.Mp.up(t),1!==t){const t=ws(this.Yf.canvas);t.save(),this.dp(t,this.Yf.pixelRatio),this.Ap&&(this.nv(t,this.Yf.pixelRatio),this.ev(t,this.Yf.pixelRatio),this.rv(t,this.Yf.pixelRatio,Vs),this.rv(t,this.Yf.pixelRatio,Ns)),t.restore()}const i=ws(this.Xf.canvas);i.clearRect(0,0,Math.ceil(this.Vf.Vt*this.Xf.pixelRatio),Math.ceil(this.Vf.Nt*this.Xf.pixelRatio)),this.rv(i,this.Yf.pixelRatio,Fs),this.hv(i,this.Xf.pixelRatio)}lv(){return this.gp}av(){return this.Mp}Lp(){null!==this.Ap&&this.Ap.Yo().v(this),this.Ap=null}qp(t){const i=t.xf,s=t.Tf;this.kp.g()&&this.kp.m(this.$i().yt().nu(i),{x:i,y:s})}dp(t,i){F(t,i,(()=>{const i=this.$i(),s=i.U(),n=i.Lc();s===n?W(t,0,0,this.Vf.Vt,this.Vf.Nt,n):H(t,0,0,this.Vf.Vt,this.Vf.Nt,s,n)}))}nv(t,i){const s=l(this.Ap),n=s.Xo().Dh().gt(s.Zt(),s.Xt());null!==n&&(t.save(),n.X(t,i,!1),t.restore())}ev(t,i){const s=this.$i()._c();this.ov(t,i,Vs,Is,s),this.ov(t,i,Vs,Bs,s)}hv(t,i){this.ov(t,i,Vs,Bs,this.$i().uc())}rv(t,i,s){const n=l(this.Ap).Ga();for(const e of n)this.ov(t,i,s,Is,e);for(const e of n)this.ov(t,i,s,Bs,e)}ov(t,i,s,n,e){const r=l(this.Ap),h=s(e,r),a=r.Zt(),o=r.Xt(),_=r.Ut().ec(),u=null!==_&&_.hc===e,c=null!==_&&u&&void 0!==_.Up?_.Up.Vr:void 0;for(const s of h){const e=s.gt(a,o);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}Qp(t,i,s){for(const n of t){const t=n.gt(this.Vf.Nt,this.Vf.Vt);if(null!==t&&t.Br){const e=t.Br(i,s);if(null!==e)return{If:n,Up:e}}}return null}Wp(){if(null===this.Ap)return;const t=this.Op,i=this.Ap.Io().F().visible,s=this.Ap.Bo().F().visible;i||null===this.gp||(this.Ip.removeChild(this.gp.np()),this.gp.M(),this.gp=null),s||null===this.Mp||(this.Bp.removeChild(this.Mp.np()),this.Mp.M(),this.Mp=null);const n=t.Ut().Tc();i&&null===this.gp&&(this.gp=new Es(this,t.F(),n,"left"),this.Ip.appendChild(this.gp.np())),s&&null===this.Mp&&(this.Mp=new Es(this,t.F(),n,"right"),this.Bp.appendChild(this.Mp.np()))}_v(t){return t.Of&&this.xp||null!==this.Tp}uv(t){return Math.max(0,Math.min(t,this.Vf.Vt-1))}cv(t){return Math.max(0,Math.min(t,this.Vf.Nt-1))}$p(t,i){this.$i().kc(this.uv(t),this.cv(i),l(this.Ap))}Kp(){this.$i().Cc()}Jp(){this.Dp&&(this.Tp=null,this.Kp())}Zp(t,i){this.Tp=t,this.Dp=!1,this.$p(i.x,i.y);const s=this.$i().uc();this.Pp={x:s.Kt(),y:s.Gt()}}$i(){return this.Op.Ut()}Xp(t){if(!this.yp)return;const i=this.$i(),s=this._p();if(i.jo(s,s.fs()),this.Sp=null,this.yp=!1,i.Mc(),null!==this.Rp){const t=performance.now(),s=i.yt();this.Rp.cr(s.lu(),t),this.Rp.bu(t)||i.Xs(this.Rp)}}jp(){this.Tp=null}Hp(){if(!this.Ap)return;if(this.$i().Us(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)l(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Ap.fs().Fi()&&this.$i().yt().Fi()}Yp(t){if(null===this.Ap)return;const i=this.$i(),s=i.yt();if(s.Fi())return;const n=this.Op.F(),e=n.handleScroll,r=n.kineticScroll;if((!e.pressedMouseMove||t.Of)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.Of))return;const h=this.Ap.fs(),l=performance.now();if(null!==this.Sp||this._v(t)||(this.Sp={x:t.gf,y:t.Mf,o_:l,xf:t.xf,Tf:t.Tf}),null!==this.Sp&&!this.yp&&(this.Sp.x!==t.gf||this.Sp.y!==t.Mf)){if(t.Of&&r.touch||!t.Of&&r.mouse){const t=s.Kn();this.Rp=new ys(.2/t,7/t,.997,15/t),this.Rp.qc(s.lu(),this.Sp.o_)}else this.Rp=null;h.Fi()||i.Wo(this.Ap,h,t.Tf),i.wc(t.xf),this.yp=!0}this.yp&&(h.Fi()||i.zo(this.Ap,h,t.Tf),i.gc(t.xf),null!==this.Rp&&this.Rp.qc(s.lu(),l))}}class zs{constructor(t,i,s,n,e){this.ft=!0,this.Vf=new ms(0,0),this.jf=()=>this.up(3),this.Uf="left"===t,this.Zu=s.Tc,this.us=i,this.dv=n,this.fv=e,this.qf=document.createElement("div"),this.qf.style.width="25px",this.qf.style.height="100%",this.qf.style.overflow="hidden",this.Yf=gs(this.qf,new ms(16,16)),this.Yf.subscribeCanvasConfigured(this.jf)}M(){this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy()}np(){return this.qf}iv(){return this.Vf}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.qf.style.width=`${t.Vt}px`,this.qf.style.minWidth=`${t.Vt}px`,this.qf.style.height=`${t.Nt}px`,this.ft=!0)}up(t){if(t<3&&!this.ft)return;if(0===this.Vf.Vt||0===this.Vf.Nt)return;this.ft=!1;const i=ws(this.Yf.canvas);this.dp(i,this.Yf.pixelRatio),this.ke(i,this.Yf.pixelRatio)}mp(){return this.Yf.canvas}ke(t,i){if(!this.dv())return;const s=this.Vf.Vt;t.save(),t.fillStyle=this.us.timeScale.borderColor;const n=Math.floor(this.Zu.F().k*i),e=this.Uf?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}dp(t,i){F(t,i,(()=>{W(t,0,0,this.Vf.Vt,this.Vf.Nt,this.fv())}))}}function js(t,i){return t.b_>i.b_?t:i}class $s{constructor(t){this.pv=null,this.vv=null,this.S=null,this.mv=!1,this.Vf=new ms(0,0),this.bv=new b,this.Ff=new jt(5),this.zf=!1,this.jf=()=>{this.zf||this.Op.Ut().Th()},this.Hf=()=>{this.zf||this.Op.Ut().Th()},this.Op=t,this.us=t.F().layout,this.wv=document.createElement("tr"),this.gv=document.createElement("td"),this.gv.style.padding="0",this.Mv=document.createElement("td"),this.Mv.style.padding="0",this.qf=document.createElement("td"),this.qf.style.height="25px",this.qf.style.padding="0",this.Sv=document.createElement("div"),this.Sv.style.width="100%",this.Sv.style.height="100%",this.Sv.style.position="relative",this.Sv.style.overflow="hidden",this.qf.appendChild(this.Sv),this.Yf=gs(this.Sv,new ms(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const i=this.Yf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Xf=gs(this.Sv,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const s=this.Xf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.wv.appendChild(this.gv),this.wv.appendChild(this.qf),this.wv.appendChild(this.Mv),this.yv(),this.Op.Ut().xo().l(this.yv.bind(this),this),this.sp=new Ds(this.Xf.canvas,this,{Yd:()=>!0,Xd:()=>!1})}M(){this.sp.M(),null!==this.pv&&this.pv.M(),null!==this.vv&&this.vv.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy()}np(){return this.wv}kv(){return this.pv}Cv(){return this.vv}lf(t){if(this.mv)return;this.mv=!0;const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.vc(t.xf)}rf(t){this.lf(t)}af(){const t=this.Op.Ut();!t.yt().Fi()&&this.mv&&(this.mv=!1,this.Op.F().handleScale.axisPressedMouseMove.time&&t.yc())}Gd(t){const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.Sc(t.xf)}Zd(t){this.Gd(t)}if(){this.mv=!1;const t=this.Op.Ut();t.yt().Fi()&&!this.Op.F().handleScale.axisPressedMouseMove.time||t.yc()}Qd(){this.if()}Id(){this.Op.F().handleScale.axisDoubleClickReset.time&&this.Op.Ut().Ks()}Ad(){this.Id()}jd(){this.Op.Ut().F().handleScale.axisPressedMouseMove.time&&this.bp(1)}bf(){this.bp(0)}iv(){return this.Vf}xv(){return this.bv}Tv(t,i,s){this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.qf.style.width=t.Vt+"px",this.qf.style.height=t.Nt+"px",this.bv.m(t)),null!==this.pv&&this.pv.ap(new ms(i,t.Nt)),null!==this.vv&&this.vv.ap(new ms(s,t.Nt))}Dv(){const t=this.Pv();return Math.ceil(t.k+t.C+t.T+t.B+t.O+t.Rv)}bt(){this.Op.Ut().yt().Gl()}mp(){return this.Yf.canvas}up(t){if(0===t)return;if(1!==t){const i=ws(this.Yf.canvas);this.dp(i,this.Yf.pixelRatio),this.ke(i,this.Yf.pixelRatio),this.fp(i,this.Yf.pixelRatio),null!==this.pv&&this.pv.up(t),null!==this.vv&&this.vv.up(t)}const i=ws(this.Xf.canvas),s=this.Xf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Vf.Vt*s),Math.ceil(this.Vf.Nt*s)),this.Av([this.Op.Ut().uc()],i,s)}dp(t,i){F(t,i,(()=>{W(t,0,0,this.Vf.Vt,this.Vf.Nt,this.Op.Ut().Lc())}))}ke(t,i){if(this.Op.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Ov();const s=Math.max(1,Math.floor(this.Pv().k*i));t.fillRect(0,0,Math.ceil(this.Vf.Vt*i),s),t.restore()}}fp(t,i){const s=this.Op.Ut().yt(),n=s.Gl();if(!n||0===n.length)return;let e=n.reduce(js,n[0]).b_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Ov();const r=this.Pv(),h=r.k+r.C+r.B+r.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Ov();const l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=s.F();if(o.borderVisible&&o.ticksVisible){t.beginPath();const s=Math.round(r.C*i);for(let e=n.length;e--;){const r=Math.round(n[e].ql*i);t.rect(r-a,0,l,s)}t.fill()}t.fillStyle=this.$(),F(t,i,(()=>{t.font=this.hp();for(const i of n)if(i.b_<e){const s=i._u?this.Lv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}t.font=this.Ev();for(const i of n)if(i.b_>=e){const s=i._u?this.Lv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}})),t.restore()}Lv(t,i,s){const n=this.Ff.Mi(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.Vf.Vt&&(i-=Math.abs(this.Vf.Vt-(r+n))),i}Av(t,i,s){const n=this.Pv();for(const e of t)for(const t of e.Ji())i.save(),t.gt().X(i,n,s),i.restore()}Ov(){return this.Op.F().timeScale.borderColor}$(){return this.us.textColor}W(){return this.us.fontSize}hp(){return D(this.W(),this.us.fontFamily)}Ev(){return D(this.W(),this.us.fontFamily,"bold")}Pv(){null===this.S&&(this.S={k:1,V:NaN,B:NaN,O:NaN,ji:NaN,C:5,T:NaN,D:"",zi:new jt,Rv:0});const t=this.S,i=this.hp();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.B=3*s/12,t.O=3*s/12,t.ji=9*s/12,t.V=0,t.Rv=4*s/12,t.zi.We()}return this.S}bp(t){this.qf.style.cursor=1===t?"ew-resize":"default"}yv(){const t=this.Op.Ut(),i=t.F();i.leftPriceScale.visible||null===this.pv||(this.gv.removeChild(this.pv.np()),this.pv.M(),this.pv=null),i.rightPriceScale.visible||null===this.vv||(this.Mv.removeChild(this.vv.np()),this.vv.M(),this.vv=null);const s={Tc:this.Op.Ut().Tc()},n=()=>i.leftPriceScale.borderVisible&&t.yt().F().borderVisible,e=()=>t.Lc();i.leftPriceScale.visible&&null===this.pv&&(this.pv=new zs("left",i,s,n,e),this.gv.appendChild(this.pv.np())),i.rightPriceScale.visible&&null===this.vv&&(this.vv=new zs("right",i,s,n,e),this.Mv.appendChild(this.vv.np()))}}class Hs{constructor(t,i){var s;this.Iv=[],this.Bv=0,this.da=0,this.qe=0,this.Vv=0,this.Nv=0,this.Fv=null,this.Wv=!1,this.kp=new b,this.qu=new b,this.us=i,this.wv=document.createElement("div"),this.wv.classList.add("tv-lightweight-charts"),this.wv.style.overflow="hidden",this.wv.style.width="100%",this.wv.style.height="100%",(s=this.wv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.zv=document.createElement("table"),this.zv.setAttribute("cellspacing","0"),this.wv.appendChild(this.zv),this.jv=this.$v.bind(this),Us(this.us)&&this.Hv(!0),this.$i=new fs(this.Xu.bind(this),this.us),this.Ut().cc().l(this.Uv.bind(this),this),this.qv=new $s(this),this.zv.appendChild(this.qv.np());let n=this.us.width,e=this.us.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.Yv(n,e),this.Xv(),t.appendChild(this.wv),this.Zv(),this.$i.yt().Su().l(this.$i.fl.bind(this.$i),this),this.$i.xo().l(this.$i.fl.bind(this.$i),this)}Ut(){return this.$i}F(){return this.us}Kv(){return this.Iv}Gv(){return this.qv}M(){this.Hv(!1),0!==this.Bv&&window.cancelAnimationFrame(this.Bv),this.$i.cc().v(this),this.$i.yt().Su().v(this),this.$i.xo().v(this),this.$i.M();for(const t of this.Iv)this.zv.removeChild(t.np()),t.Gp().v(this),t.M();this.Iv=[],l(this.qv).M(),null!==this.wv.parentElement&&this.wv.parentElement.removeChild(this.wv),this.qu.M(),this.kp.M()}Yv(t,i,s=!1){if(this.da===i&&this.qe===t)return;this.da=i,this.qe=t;const n=i+"px",e=t+"px";l(this.wv).style.height=n,l(this.wv).style.width=e,this.zv.style.height=n,this.zv.style.width=e,s?this.Jv(it.en(),performance.now()):this.$i.fl()}up(t){void 0===t&&(t=it.en());for(let i=0;i<this.Iv.length;i++)this.Iv[i].up(t.$s(i).Ws);this.us.timeScale.visible&&this.qv.up(t.js())}xh(t){const i=Us(this.us);this.$i.xh(t);const s=Us(this.us);s!==i&&this.Hv(s),this.Zv();const n=t.width||this.qe,e=t.height||this.da;this.Yv(n,e)}Gp(){return this.kp}cc(){return this.qu}Qv(){null!==this.Fv&&(this.Jv(this.Fv,performance.now()),this.Fv=null);const t=this.Iv[0],i=function(t,i){const s=t.createElement("canvas"),n=bs(s);return s.style.width=`${i.Vt}px`,s.style.height=`${i.Nt}px`,s.width=i.Vt*n,s.height=i.Nt*n,s}(document,new ms(this.qe,this.da)),s=ws(i),n=bs(i);return F(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.Iv.length;e++){const r=this.Iv[e],h=r.iv().Nt,a=l("left"===t?r.lv():r.av()),o=a.mp();s.drawImage(o,i,n,a.op(),h),n+=h}};this.tm()&&(e("left"),i=l(t.lv()).op()),n=0;for(let t=0;t<this.Iv.length;t++){const e=this.Iv[t],r=e.iv(),h=e.mp();s.drawImage(h,i,n,r.Vt,r.Nt),n+=r.Nt}i+=t.iv().Vt,this.im()&&(n=0,e("right"));const r=t=>{const e=l("left"===t?this.qv.kv():this.qv.Cv()),r=e.iv(),h=e.mp();s.drawImage(h,i,n,r.Vt,r.Nt)};if(this.us.timeScale.visible){i=0,this.tm()&&(r("left"),i=l(t.lv()).op());const e=this.qv.iv(),h=this.qv.mp();s.drawImage(h,i,n,e.Vt,e.Nt),this.im()&&(i+=t.iv().Vt,r("right"),s.restore())}})),i}sm(t){if("left"===t&&!this.tm())return 0;if("right"===t&&!this.im())return 0;if(0===this.Iv.length)return 0;return l("left"===t?this.Iv[0].lv():this.Iv[0].av()).op()}nm(){let t=0,i=0,s=0;for(const n of this.Iv)this.tm()&&(i=Math.max(i,l(n.lv()).rp())),this.im()&&(s=Math.max(s,l(n.av()).rp())),t+=n.To();const n=this.qe,e=this.da,r=Math.max(n-i-s,0),h=this.us.timeScale.visible;let a=h?this.qv.Dv():0;a%2&&(a+=1);const o=0+a,_=e<o?0:e-o,u=_/t;let c=0;for(let t=0;t<this.Iv.length;++t){const n=this.Iv[t];n.Fp(this.$i.oc()[t]);let e=0,h=0;h=t===this.Iv.length-1?_-c:Math.round(n.To()*u),e=Math.max(h,2),c+=e,n.ap(new ms(r,e)),this.tm()&&n.tv(i,"left"),this.im()&&n.tv(s,"right"),n._p()&&this.$i.dc(n._p(),e)}this.qv.Tv(new ms(h?r:0,a),h?i:0,h?s:0),this.$i.Po(r),this.Vv!==i&&(this.Vv=i),this.Nv!==s&&(this.Nv=s)}Hv(t){t?this.wv.addEventListener("wheel",this.jv,{passive:!1}):this.wv.removeEventListener("wheel",this.jv)}$v(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.us.handleScroll.mouseWheel||0!==s&&this.us.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.us.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.wv.getBoundingClientRect().left;this.Ut().mc(n,i)}0!==i&&this.us.handleScroll.mouseWheel&&this.Ut().bc(-80*i)}}Jv(t,i){var s;const n=t.js();3===n&&this.rm(),3!==n&&2!==n||(this.hm(t),this.lm(t,i),this.qv.bt(),this.Iv.forEach((t=>{t.zp()})),3===(null===(s=this.Fv)||void 0===s?void 0:s.js())&&(this.Fv.tn(t),this.rm(),this.hm(this.Fv),this.lm(this.Fv,i),t=this.Fv,this.Fv=null)),this.up(t)}lm(t,i){for(const s of t.Qs())this.sn(s,i)}hm(t){const i=this.$i.oc();for(let s=0;s<i.length;s++)t.$s(s).zs&&i[s].Uo()}sn(t,i){const s=this.$i.yt();switch(t.qs){case 0:s.ku();break;case 1:s.Cu(t.Rt);break;case 2:s.Gs(t.Rt);break;case 3:s.Js(t.Rt);break;case 4:s.uu();break;case 5:t.Rt.bu(i)||s.Js(t.Rt.wu(i))}}Xu(t){null!==this.Fv?this.Fv.tn(t):this.Fv=t,this.Wv||(this.Wv=!0,this.Bv=window.requestAnimationFrame((t=>{if(this.Wv=!1,this.Bv=0,null!==this.Fv){const i=this.Fv;this.Fv=null,this.Jv(i,t);for(const s of i.Qs())if(5===s.qs&&!s.Rt.bu(t)){this.Ut().Xs(s.Rt);break}}})))}rm(){this.Xv()}Xv(){const t=this.$i.oc(),i=t.length,s=this.Iv.length;for(let t=i;t<s;t++){const t=h(this.Iv.pop());this.zv.removeChild(t.np()),t.Gp().v(this),t.M()}for(let n=s;n<i;n++){const i=new Ws(this,t[n]);i.Gp().l(this.am.bind(this),this),this.Iv.push(i),this.zv.insertBefore(i.np(),this.qv.np())}for(let s=0;s<i;s++){const i=t[s],n=this.Iv[s];n._p()!==i?n.Fp(i):n.Np()}this.Zv(),this.nm()}om(t,i){var s;const n=new Map;if(null!==t){this.$i.wt().forEach((i=>{const s=i.Is().$h(t);null!==s&&n.set(i,s)}))}let e;if(null!==t){const i=null===(s=this.$i.yt().Hi(t))||void 0===s?void 0:s.w_;void 0!==i&&(e=i)}const r=this.Ut().ec(),h=null!==r&&r.hc instanceof Ci?r.hc:void 0,l=null!==r&&void 0!==r.Up?r.Up.Fr:void 0;return{ot:e,Yn:null!=t?t:void 0,_m:null!=i?i:void 0,um:h,dm:n,fm:l}}am(t,i){this.kp.m((()=>this.om(t,i)))}Uv(t,i){this.qu.m((()=>this.om(t,i)))}Zv(){const t=this.us.timeScale.visible?"":"none";this.qv.np().style.display=t}tm(){return this.Iv[0]._p().Io().F().visible}im(){return this.Iv[0]._p().Bo().F().visible}}function Us(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function qs(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.color&&(r.R=s.color),r}function Ys(t){return void 0!==t.Rt}function Xs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{ot:i,Yn:s,w_:e}:t(i,s,n,e);var r}}const Zs={Candlestick:Xs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.At=s.borderColor),void 0!==s.wickColor&&(e.Ah=s.wickColor),e})),Bar:Xs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),e})),Area:Xs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.lineColor&&(r.lt=s.lineColor),void 0!==s.topColor&&(r.vn=s.topColor),void 0!==s.bottomColor&&(r.mn=s.bottomColor),r})),Baseline:Xs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.topLineColor&&(r.be=s.topLineColor),void 0!==s.bottomLineColor&&(r.we=s.bottomLineColor),void 0!==s.topFillColor1&&(r.de=s.topFillColor1),void 0!==s.topFillColor2&&(r.fe=s.topFillColor2),void 0!==s.bottomFillColor1&&(r.pe=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(r.ve=s.bottomFillColor2),r})),Histogram:Xs(qs),Line:Xs(qs)};function Ks(t){return Zs[t]}function Gs(t){return 60*t*60*1e3}function Js(t){return 60*t*1e3}const Qs=[{pm:(tn=1,1e3*tn),b_:10},{pm:Js(1),b_:20},{pm:Js(5),b_:21},{pm:Js(30),b_:22},{pm:Gs(1),b_:30},{pm:Gs(3),b_:31},{pm:Gs(6),b_:32},{pm:Gs(12),b_:33}];var tn;function sn(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Qs.length-1;s>=0;--s)if(Math.floor(i.getTime()/Qs[s].pm)!==Math.floor(t.getTime()/Qs[s].pm))return Qs[s].b_;return 0}function nn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ot.o_,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ot.o_);null!==n&&(i.m_=sn(h,n)),e+=i.ot.o_-(s||i.ot.o_),s=i.ot.o_,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ot.o_-i));t[0].m_=sn(new Date(1e3*t[0].ot.o_),s)}}function en(t){if(!ps(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{o_:Math.round(i.getTime()/1e3),a_:t}}function rn(t){if(!vs(t))throw new Error("time must be of type isUTCTimestamp");return{o_:t}}function hn(t){return 0===t.length?null:ps(t[0].time)?en:rn}function ln(t){return vs(t)?rn(t):ps(t)?en(t):en(an(t))}function an(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function on(t){S(t.time)&&(t.time=an(t.time))}function _n(t){return{Yn:0,vm:new Map,Cl:t}}function un(t){if(void 0!==t&&0!==t.length)return{bm:t[0].ot.o_,wm:t[t.length-1].ot.o_}}function cn(t){let i;return t.forEach((t=>{void 0===i&&(i=t.w_)})),h(i)}function dn(t){void 0===t.w_&&(t.w_=t.time)}class fn{constructor(){this.gm=new Map,this.Mm=new Map,this.Sm=new Map,this.ym=[]}M(){this.gm.clear(),this.Mm.clear(),this.Sm.clear(),this.ym=[]}km(t,i){let s=0!==this.gm.size,n=!1;const e=this.Mm.get(t);if(void 0!==e)if(1===this.Mm.size)s=!1,n=!0,this.gm.clear();else for(const i of this.ym)i.pointData.vm.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>dn(t))),function(t){t.forEach(on)}(i);const e=l(hn(i)),h=Ks(t.Ih());r=s.map((i=>{const s=e(i.time);let r=this.gm.get(s.o_);void 0===r&&(r=_n(s),this.gm.set(s.o_,r),n=!0);const l=h(s,r.Yn,i,i.w_);return r.vm.set(t,l),l}))}s&&this.Cm(),this.xm(t,r);let h=-1;if(n){const t=[];this.gm.forEach((i=>{t.push({m_:0,ot:i.Cl,pointData:i,w_:cn(i.vm)})})),t.sort(((t,i)=>t.ot.o_-i.ot.o_)),h=this.Tm(t)}return this.Dm(t,h,function(t,i){const s=un(t),n=un(i);if(void 0!==s&&void 0!==n)return{bl:s.wm>=n.wm&&s.bm>=n.bm}}(this.Mm.get(t),e))}Rc(t){return this.km(t,[])}Pm(t,i){const s=i;dn(s),on(i);const n=l(hn([i]))(i.time),e=this.Sm.get(t);if(void 0!==e&&n.o_<e.o_)throw new Error(`Cannot update oldest data, last time=${e.o_}, new time=${n.o_}`);let r=this.gm.get(n.o_);const h=void 0===r;void 0===r&&(r=_n(n),this.gm.set(n.o_,r));const a=Ks(t.Ih())(n,r.Yn,i,s.w_);r.vm.set(t,a),this.Rm(t,a);const o={bl:Ys(a)};if(!h)return this.Dm(t,-1,o);const _={m_:0,ot:r.Cl,pointData:r,w_:cn(r.vm)},u=bt(this.ym,_.ot.o_,((t,i)=>t.ot.o_<i));this.ym.splice(u,0,_);for(let t=u;t<this.ym.length;++t)pn(this.ym[t].pointData,t);return nn(this.ym,u),this.Dm(t,u,o)}Rm(t,i){let s=this.Mm.get(t);void 0===s&&(s=[],this.Mm.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.ot.o_>n.ot.o_?Ys(i)&&s.push(i):Ys(i)?s[s.length-1]=i:s.splice(-1,1),this.Sm.set(t,i.ot)}xm(t,i){0!==i.length?(this.Mm.set(t,i.filter(Ys)),this.Sm.set(t,i[i.length-1].ot)):(this.Mm.delete(t),this.Sm.delete(t))}Cm(){for(const t of this.ym)0===t.pointData.vm.size&&this.gm.delete(t.ot.o_)}Tm(t){let i=-1;for(let s=0;s<this.ym.length&&s<t.length;++s){const n=this.ym[s],e=t[s];if(n.ot.o_!==e.ot.o_){i=s;break}e.m_=n.m_,pn(e.pointData,s)}if(-1===i&&this.ym.length!==t.length&&(i=Math.min(this.ym.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)pn(t[s].pointData,s);return nn(t,i),this.ym=t,i}Am(){if(0===this.Mm.size)return null;let t=0;return this.Mm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Yn))})),t}Dm(t,i,s){const n={Om:new Map,yt:{su:this.Am()}};if(-1!==i)this.Mm.forEach(((i,e)=>{n.Om.set(e,{hr:i,Lm:e===t?s:void 0})})),this.Mm.has(t)||n.Om.set(t,{hr:[],Lm:s}),n.yt.Em=this.ym,n.yt.Im=i;else{const i=this.Mm.get(t);n.Om.set(t,{hr:i||[],Lm:s})}return n}}function pn(t,i){t.Yn=i,t.vm.forEach((t=>{t.Yn=i}))}function vn(t){return{value:t.Rt[3],time:t.w_}}function mn(t){const i=vn(t);return void 0!==t.R&&(i.color=t.R),i}function bn(t){return{open:t.Rt[0],high:t.Rt[1],low:t.Rt[2],close:t.Rt[3],time:t.w_}}const wn={Area:function(t){const i=vn(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.vn&&(i.topColor=t.vn),void 0!==t.mn&&(i.bottomColor=t.mn),i},Line:mn,Baseline:function(t){const i=vn(t);return void 0!==t.be&&(i.topLineColor=t.be),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.de&&(i.topFillColor1=t.de),void 0!==t.fe&&(i.topFillColor2=t.fe),void 0!==t.pe&&(i.bottomFillColor1=t.pe),void 0!==t.ve&&(i.bottomFillColor2=t.ve),i},Histogram:mn,Bar:function(t){const i=bn(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=bn(t),{R:s,At:n,Ah:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}};function gn(t){return wn[t]}const Mn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},Sn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:T,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},yn={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:T},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Mn),leftPriceScale:Object.assign(Object.assign({},Mn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Mn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:Sn,localization:{locale:ks?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},kn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Cn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},xn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Tn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Dn={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Pn={color:"#26a69a",base:0},Rn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class An{constructor(t,i){this.Bm=t,this.Vm=i}applyOptions(t){this.Bm.Ut().lc(this.Vm,t)}options(){return this.Vi().F()}width(){return tt(this.Vm)?this.Bm.sm(this.Vm):0}Vi(){return l(this.Bm.Ut().ac(this.Vm)).Pt}}const On={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class Ln{constructor(t){this.Mh=t}applyOptions(t){this.Mh.xh(t)}options(){return this.Mh.F()}Nm(){return this.Mh}}class En{constructor(t,i,s){this.Tn=t,this.Fm=i,this.Wm=s}priceFormatter(){return this.Tn.Ol()}priceToCoordinate(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().Dt(t,i.Rt)}coordinateToPrice(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().ps(t,i.Rt)}barsInLogicalRange(t){if(null===t)return null;const i=new es(new is(t.from,t.to)).k_(),s=this.Tn.Is();if(s.Fi())return null;const n=s.$h(i.gn(),1),e=s.$h(i.Mn(),-1),r=l(s.Wh()),h=l(s.Es());if(null!==n&&null!==e&&n.Yn>e.Yn)return{barsBefore:t.from-r,barsAfter:h-t.to};const a={barsBefore:null===n||n.Yn===r?t.from-r:n.Yn-r,barsAfter:null===e||e.Yn===h?h-t.to:h-e.Yn};return null!==n&&null!==e&&(a.from=n.ot.a_||n.ot.o_,a.to=e.ot.a_||e.ot.o_),a}setData(t){this.Tn.Ih(),this.Fm.zm(this.Tn,t)}update(t){this.Tn.Ih(),this.Fm.jm(this.Tn,t)}dataByIndex(t,i){const s=this.Tn.Is().$h(t,i);return null===s?null:gn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:ln(t.time)})));this.Tn.gl(i)}markers(){return this.Tn.Ml().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.Tn.xh(t)}options(){return k(this.Tn.F())}priceScale(){return this.Wm.priceScale(this.Tn.Pt().Vl())}createPriceLine(t){const i=w(k(On),t),s=this.Tn.Sl(i);return new Ln(s)}removePriceLine(t){this.Tn.yl(t.Nm())}seriesType(){return this.Tn.Ih()}}class In{constructor(t,i){this.$m=new b,this.E_=new b,this.bv=new b,this.$i=t,this.mo=t.yt(),this.qv=i,this.mo.gu().l(this.Hm.bind(this)),this.mo.Mu().l(this.Um.bind(this)),this.qv.xv().l(this.qm.bind(this))}M(){this.mo.gu().v(this),this.mo.Mu().v(this),this.qv.xv().v(this),this.$m.M(),this.E_.M(),this.bv.M()}scrollPosition(){return this.mo.lu()}scrollToPosition(t,i){i?this.mo.mu(t,1e3):this.$i.Js(t)}scrollToRealTime(){this.mo.vu()}getVisibleRange(){var t,i;const s=this.mo.Z_();return null===s?null:{from:null!==(t=s.from.a_)&&void 0!==t?t:s.from.o_,to:null!==(i=s.to.a_)&&void 0!==i?i:s.to.o_}}setVisibleRange(t){const i={from:ln(t.from),to:ln(t.to)},s=this.mo.Q_(i);this.$i.Ac(s)}getVisibleLogicalRange(){const t=this.mo.X_();return null===t?null:{from:t.gn(),to:t.Mn()}}setVisibleLogicalRange(t){r(t.from<=t.to,"The from index cannot be after the to index."),this.$i.Ac(t)}resetTimeScale(){this.$i.Ks()}fitContent(){this.$i.ku()}logicalToCoordinate(t){const i=this.$i.yt();return i.Fi()?null:i.Lt(t)}coordinateToLogical(t){return this.mo.Fi()?null:this.mo.nu(t)}timeToCoordinate(t){const i=ln(t),s=this.mo.Fl(i,!1);return null===s?null:this.mo.Lt(s)}coordinateToTime(t){var i;const s=this.$i.yt(),n=s.nu(t),e=s.vs(n);return null===e?null:null!==(i=e.a_)&&void 0!==i?i:e.o_}width(){return this.qv.iv().Vt}height(){return this.qv.iv().Nt}subscribeVisibleTimeRangeChange(t){this.$m.l(t)}unsubscribeVisibleTimeRangeChange(t){this.$m.p(t)}subscribeVisibleLogicalRangeChange(t){this.E_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.E_.p(t)}subscribeSizeChange(t){this.bv.l(t)}unsubscribeSizeChange(t){this.bv.p(t)}applyOptions(t){this.mo.xh(t)}options(){return k(this.mo.F())}Hm(){this.$m.g()&&this.$m.m(this.getVisibleRange())}Um(){this.E_.g()&&this.E_.m(this.getVisibleLogicalRange())}qm(t){this.bv.m(t.Vt,t.Nt)}}function Bn(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function Vn(t){return function(t){if(y(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;y(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),y(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;y(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Nn{constructor(t,i){this.Ym=new fn,this.Xm=new Map,this.Zm=new Map,this.Km=new b,this.Gm=new b;const s=void 0===i?k(yn):w(k(yn),Vn(i));this.Bm=new Hs(t,s),this.Bm.Gp().l((t=>{this.Km.g()&&this.Km.m(this.Jm(t()))}),this),this.Bm.cc().l((t=>{this.Gm.g()&&this.Gm.m(this.Jm(t()))}),this);const n=this.Bm.Ut();this.Qm=new In(n,this.Bm.Gv())}remove(){this.Bm.Gp().v(this),this.Bm.cc().v(this),this.Qm.M(),this.Bm.M(),this.Xm.clear(),this.Zm.clear(),this.Km.M(),this.Gm.M(),this.Ym.M()}resize(t,i,s){this.Bm.Yv(t,i,s)}addAreaSeries(t){return this.tb("Area",Tn,t)}addBaselineSeries(t){return this.tb("Baseline",Dn,t)}addBarSeries(t){return this.tb("Bar",Cn,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.tb("Candlestick",kn,t)}addHistogramSeries(t){return this.tb("Histogram",Pn,t)}addLineSeries(t){return this.tb("Line",xn,t)}removeSeries(t){const i=h(this.Xm.get(t)),s=this.Ym.Rc(i);this.Bm.Ut().Rc(i),this.ib(s),this.Xm.delete(t),this.Zm.delete(i)}zm(t,i){this.ib(this.Ym.km(t,i))}jm(t,i){this.ib(this.Ym.Pm(t,i))}subscribeClick(t){this.Km.l(t)}unsubscribeClick(t){this.Km.p(t)}subscribeCrosshairMove(t){this.Gm.l(t)}unsubscribeCrosshairMove(t){this.Gm.p(t)}priceScale(t){return new An(this.Bm,t)}timeScale(){return this.Qm}applyOptions(t){this.Bm.xh(Vn(t))}options(){return this.Bm.F()}takeScreenshot(){return this.Bm.Qv()}tb(t,i,s={}){Bn(s.priceFormat);const n=w(k(Rn),k(i),s),e=this.Bm.Ut().Dc(t,n),r=new En(e,this,this);return this.Xm.set(r,e),this.Zm.set(e,r),r}ib(t){const i=this.Bm.Ut();i.xc(t.yt.su,t.yt.Em,t.yt.Im),t.Om.forEach(((t,i)=>i.tt(t.hr,t.Lm))),i.ru()}sb(t){return h(this.Zm.get(t))}Jm(t){const i=new Map;t.dm.forEach(((t,s)=>{const n=gn(s.Ih())(t);r(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.sb(s),n)}));const s=void 0===t.um?void 0:this.sb(t.um);return{time:t.ot,logical:t.Yn,point:t._m,hoveredSeries:s,hoveredMarkerId:t.fm,seriesData:i}}}function Fn(t,i){let s;if(S(t)){const i=document.getElementById(t);r(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Nn(s,i)}function Wn(){return"4.0.0-dev+202307060029"}export{os as ColorType,J as CrosshairMode,ls as LastPriceAnimationMode,s as LineStyle,i as LineType,Mi as MismatchDirection,as as PriceLineSource,$i as PriceScaleMode,rs as TickMarkType,hs as TrackingModeExitMode,Fn as createChart,ps as isBusinessDay,vs as isUTCTimestamp,Wn as version};
